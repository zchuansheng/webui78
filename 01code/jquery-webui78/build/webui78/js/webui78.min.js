(function(a){a.webTipTool={s:{tip_div:"validator_msg_div",tip_top:"vmsg_tips_top",tip_btm:"vmsg_tips_bottom",displaySpeed:20,displayTime:2500},showTipInContent:function(b,c){if(c!=""&&b.val()==""){b.val(c);b.css("color","#999999")}b.focus(function(){var d=b.val();if(c==d){this.value="";a(this).css("color","#000000")}}).blur(function(){if(this.value==""&&c!=""){this.value=c}if(this.value==c){a(this).css("color","#999999")}})},getTipTool:function(){if(this.tool!==undefined){return this.tool}var b=a("#"+this.s.tip_div);if(b.length==0){b=a("<div id='"+this.s.tip_div+"' style='display:none;position:absolute;z-index:78000'></div>");var c=a("<span class='vmsg_tips' style='display:block'></span>");c.append(a("<span class='vmsg_tips_top'  style='display:block'></span>"));c.append(a("<b class='vmsg_tips_bottom' style='display:block' />"));c.css({filter:"alpha(opacity:90)",KHTMLOpacity:"0.90",MozOpacity:"0.90",opacity:"0.90"});b.append(c);a("body").append(b)}this.tool=b;return this.tool},setTipMessage:function(b,d){var e=this.getTipTool();var f=b;if(d!==undefined){f='<div class="'+d+'">&nbsp;&nbsp;&nbsp;&nbsp;</div>&nbsp;&nbsp;'+f}a("."+this.s.tip_top,e).html(f)},moveTipTool:function(d,c){var b=this.getTipTool();b.css({top:(c+2)+"px",left:(d-40)+"px"})},bindShowMessage:function(c,d){var b=a.webTipTool;c.bind({mouseover:function(f){b.getTipTool().show();b.setTipMessage(d,"icon_warning");var g=a.webValidator.getMousePosition(f);b.moveTipTool(g.x,g.y)},mouseout:function(){a.webTipTool.getTipTool().hide()},mousemove:function(g){var f=a.webTipTool;f.getTipTool().show();f.setTipMessage(d,"icon_warning");var h=a.webValidator.getMousePosition(g);f.moveTipTool(h.x,h.y)}})},showMessage:function(f,d,c){var m=a.webValidator.tipTool;var b=a(f);var g=b.is(":visible");if(!g){var k=b.closest(".datagrid_gridtb");if(k!=null&&k[0].grid!=null&&k[0].grid.page!=null){var e=k[0].grid.page.indexofPage(b);if(e>0&&e<=k[0].grid.page.op.totalPages){k[0].grid.page.showPage(e)}}}var j=m.getTipTool();var i=b;if(!g){i=b.closest(":visible")}var h=b.closest(".webdialog_body");if(h.length>0){if(a("#"+this.s.tip_div,h).length>0){return}h.append(m.tool);m.moveTipTool(i.position().left+i.width()/2,i.position().top+i.height()/2)}else{m.moveTipTool(i.offset().left+i.width()/2,i.offset().top+i.height()/2)}var l=parseInt(new Date().getTime()/1000);j.css({"z-index":l});m.setTipMessage(d,c);j.show();j.fadeIn(this.s.displaySpeed).delay(this.s.displayTime);j.fadeOut(this.s.displaySpeed,function(){j.hide();if(h.length>0){a("body").append(m.tool)}});b.focus()},showTipMessage:function(g){var g=a.extend({target:null,msg:"",icon:"no",container:"body"},g);var d=a.webTipTool;var f=a(obj);if(!f.is(":visible")){var e=f.closest(".datagrid_gridtb");if(e!=null&&e[0].grid!=null&&e[0].grid.page!=null){var b=e[0].grid.page.indexofPage(f);if(b>0&&b<=e[0].grid.page.op.totalPages){e[0].grid.page.showPage(b)}}}var c=d.getTipTool();if(g.container!=null){a(g.container).append(d.tool)}d.moveTipTool(f.position().left+f.width()/2,f.position().top+f.height()/2);d.setTipMessage(msg,ic);d.getTipTool().show();c.fadeIn(this.s.displaySpeed).delay(this.s.displayTime);c.fadeOut(this.s.displaySpeed,function(){d.getTipTool().hide()});f.focus()}};a.fn.setTipMessage=function(b){return this.each(function(){var c=a(this);this.tipmsg=b;a.webTipTool.bindShowMessage(c,this.tipmsg)})}})(jQuery);(function(a){a.fn.setmask=function(b){var c={msg:null,zindex:parseInt(new Date().getTime()/1000)};a(this).each(function(){var g=a.extend({},c,b);var f=a(this);if(f.isMasked()){return}f.addClass("ismasked");f.data("ismasked",true);var e=a('<div class="ui-mask"></div>');var l=f[0].tagName!=null?f[0].tagName.toLowerCase():null;if(l!=null){var d=f.height()+a.webUtil.getElCss(f,"padding-top")+a.webUtil.getElCss(f,"padding-bottom");e.css({height:d,width:f.width(),top:f.offset().top,left:f.offset().left,"z-index":g.zindex})}var h=a("body");h.append(e);if(g.msg!=null){var i=a('<div class="ui-mask-msg" style="display:none;"><div>'+g.msg+"</div></div>");h.append(i);i.show();var j=g.caller!=null?a(g.caller).offset().top:e.height()/2-i.height()/2;var k=g.caller!=null?a(g.caller).offset().left:e.width()/2-i.width()/2;i.css({top:e.offset().top+j,left:e.offset().left+k,"z-index":g.zindex})}f.data("ui_mask_div",e);f.data("ui-mask-msg_div",i)})};a.fn.unmask=function(b){a(this).each(function(){var c=a(this);if(b!=null){c.find("#ui-mask_"+b).remove();c.find("#ui-mask-msg_"+b).remove()}var e=c.data("ui_mask_div");if(e==null){e=c.find(".ui-mask")}e.remove();var d=c.data("ui-mask-msg_div");if(d==null){d=c.find(".ui-mask-msg")}d.remove();c.removeClass("masked-relative");c.removeClass("ismasked");c.data("ismasked",false)})};a.fn.isMasked=function(){return this.data("ismasked")}})(jQuery);document.write("<div class='ui-mask' id='ui-mask_load' ></div><div class='ui-mask-msg' id='ui-mask-msg_load'  ><div style='z-index: 100;'>页面正在加载......</div></div>");$(window).bind("load",function(){$(document).unmask("load")});if($.browser==null){$.browser={};$.browser.msie=/msie/.test(navigator.userAgent.toLowerCase())}if($.browser.msie){window.onbeforeprint=function(){$(document).unmask("load")}}$(document.body).ready(function(){if($.webUtil.setting.navTitleParamName!=null){var a=$.webUtil.setting.navTitleParamName;var b=$(".headline:first");if(b!=null&&$("#"+a).length==0){$("form:first").append("<input type='hidden' id ='"+a+"' name='"+a+"' value='"+$.trim(b.text())+"' >")}}});(function(a){a.webUtil={submitByButton:function(d){var f={button:null,target:null,url:null};var e=a.extend(f,d);var c=e.button.data("btn_setting");var b="您确定要'"+e.button.text()+"'吗？";var g={url:e.url,frm:c.formobj,tipmsg:c.istip?b:null,ismask:c.ismask,mask:c.maskobj,btn:e.button,trgt:e.target,ischeck:c.ischeck};a.webUtil.submit(g.url,g)},checkSession:function(){if(!a.webUtil.setting.ischecksession){return true}if(a.webUtil.setting.sessionidName==null){a.webUtil.setting.sessionidName="JSESSIONID"}if(document.cookie.length<=0){return true}var d=document.cookie.indexOf(a.webUtil.setting.sessionidName+"=");if(d<0){return false}d=d+a.webUtil.setting.sessionidName.length+1;iend=document.cookie.indexOf(";",d);if(iend==-1){iend=document.cookie.length}var c=unescape(document.cookie.substring(d,iend));var b=a(a.webUtil.setting.elmentOfSesssion).val()||a(a.webUtil.setting.elmentOfSesssion).text();if(b!=null&&b.length>0&&b.indexOf(c)<0){alert("会话已经失效或变更，当前页面无效请刷新页面或重新登录！");return false}else{return true}},submitOnBtn:function(e,f,b){var d=f.data("btn_setting");var c="您确定要'"+f.text()+"'吗？";var g={frm:d.formobj,tipmsg:d.istip?c:null,ismask:d.ismask,mask:d.maskobj,btn:f,trgt:b,ischeck:d.ischeck};a.webUtil.submit(e,g)},ajaxSubmit:function(f){if(f.btn){var d=f.btn.data("btn_setting");var b="您确定要'"+f.btn.text()+"'吗？";var e={frm:d.formobj,tipmsg:d.istip?b:null,mask:d.maskobj,btn:f.btn,trgt:f.trgt,ajax:f};a.webUtil.submit(f.url,e)}else{var c=a.extend({ajax:f},f);a.webUtil.submit(f.url,c)}},submit:function(e,f){if(!this.checkSession()){return false}f=a.extend({ischeck:true,ismask:true},f);f.mask=(f.mask==null)?a(document):f.mask;var c=(f.frm==null)?a("[name='form1']"):f.frm;if(f.isformdata==true){if(c.length==0){alert("找不到表单对象！请检查代码是否正确！");return}if(c.attr("method")==null){c.attr("method","POST")}}var b=a(document.body).data("submitting");if(b==true){return}if(f.ismask){a(f.mask).setmask({msg:a.webUtil.setting.messageOnLoading,caller:f.btn})}if(f.async==false){a.webUtil.toSubmit(c,e,f)}else{var d=setTimeout(function(){a.webUtil.toSubmit(c,e,f);d=null},50)}},toSubmit:function(b,c,g){if(a(document.body).data("submitting")){return false}a(document.body).data("submitting",true);var f=a(g.mask);if(g.ismask){f.setmask({msg:a.webUtil.setting.messageOnLoading,caller:g.btn})}if(g.ischeck&&g.isformdata&&(!b.formIsValid())){a(document.body).data("submitting",false);if(g.ismask){f.unmask()}return false}function e(){a(document.body).data("submitting",false);if(g.ismask){f.unmask()}return false}function d(){if(g.trgt!=null&&b!=null){b.attr("target",g.trgt)}if(g.trgt!=null&&g.trgt!=""){a(document.body).data("submitting",false);if(g.ismask){f.unmask()}}if(g.ajax==null&&g.isformdata){b.attr("action",c);b.submit()}else{if(g.ajax.url==null){g.ajax.url=c}var h=g.ajax.success;g.ajax.success=function(j){a(document.body).data("submitting",false);if(jQuery.isFunction(h)){h.call(a,j)}if(g.ismask){f.unmask()}};var i=g.ajax.complete;g.ajax.complete=function(k,j){a(document.body).data("submitting",false);if(jQuery.isFunction(i)){i.call(a,k,j)}if(g.ismask){f.unmask()}};a.webUtil.submitByAjax(g.ajax);if(g.async==false&&g.ismask){f.unmask()}}return true}if(g.tipmsg!=null){if(a.webUtil.setting.msgboxtype=="custom"){a.webUtil.confirm(g.tipmsg,function(){d()},function(){e()})}else{if(!confirm(g.tipmsg)){e()}else{d()}}}else{d()}},submitByAjax:function(h){var b=(h.frm==null)?a("[name='form1']"):h.frm;var g=b.attr("method");var f=b.attr("action");var d=(typeof f==="string")?a.trim(f):"";d=d||window.location.href||"";if(d){d=(d.match(/^([^#]+)/)||[])[1]}if(typeof h=="function"){h={success:h}}h=a.extend(true,{url:d,success:a.ajaxSettings.success,error:function(j,i,k){alert(i+":["+this.url+"]"+k.message)},type:g||"POST",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},h);var e=(h.data==null)?null:h.data;var c=null;if(h.isformdata==null||h.isformdata==true){c=b.serialize()}if(e!=null&&c!=null){e=c+"&"+jQuery.param(e)}else{e=(e==null)?c:e}if(h.type.toUpperCase()=="GET"){h.url+=(h.url.indexOf("?")>=0?"&":"?")+jQuery.param(e);h.data=null}else{h.data=e}if(this.ajaxObj!=null){this.ajaxObj(h)}else{a.ajax(h)}},gotoPage:function(b){window.location.href=b},open:function(d,g){g=a.extend({},g);var e=g.widths,f=g.heights;var b=g.popup;if(e==null||""==e){e="800"}if(f==null||""==f){f="680"}var c="height="+f+", width="+e+",toolbar=no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=yes";if(g.option!=null){c=g.option}window.open(d,(g.name==null)?"":g.name,c).focus()},openWindow:function(b){a("body").webDialog(b)},alert:function(e,b,f){var c=function(g){a(".header .closer",g.data.target).trigger("click");if(b!=null){b()}};var d=a('<div class="webdialog_message"></div>').append(e);a.webUtil.openWindow({title:"消息提示",width:300,height:150,content:d,ismodel:true,buttons:[{btn:"<button>"+(f==null?"确定":f)+"</button>",onclick:c}]})},confirm:function(g,c,e){var b=function(h){a(h.data.target).closeWebDialog();if(c!=null){c()}};var d=function(h){a(h.data.target).closeWebDialog();if(e!=null){e()}};var f=a('<div class="webdialog_message"></div>').append(g);a.webUtil.openWindow({title:"确认提示",width:300,height:170,content:f,ismodel:true,buttons:[{btn:"<button>确认</button>",onclick:b},{btn:"<button >取消</button>",onclick:d}]})},onKeyDownEnter:function(c,d,b){if(b==null){b="click"}c.each(function(){a(this).bind("keydown",function(g){var f=g.which?g.which:g.keyCode;if(f==13){d.trigger(b)}})});return false},bindKeyDownEnter:function(c,b){c.each(function(){a(this).bind("keydown",function(f){var d=f.which?f.which:f.keyCode;if(d==13){b(f.target)}})});return false},getElCss:function(c,b){var d=parseInt(c.css(b));return isNaN(d)?0:d},check_against:function(b,c){a.each(a(":checkbox."+b),function(){this.checked=!this.checked;if(c!=undefined){c(a(this))}})},tableSpanSame:function(m,k,j,b){var c=a(m);var g=null,e,d;var i=1,f=0;var l=null,h=null;if(j=="rowspan"){l=c.find(">tbody>tr td:nth-child("+k+")");if(b!=null){h=c.find(">tbody>tr td:nth-child("+b+")")}}else{l=c.find(">tbody>tr:nth-child("+k+") >td ");if(b!=null){h=c.find(">tbody>tr:nth-child("+b+") >td ")}}l.each(function(n){var o=a(this);if(n==0){g=o;return}e=o.text();d=g.text();if(h!=null){e=h.eq(n).text()+e;d=h.eq(f).text()+d}if(e==d){o.hide();i++}else{if(i>1){g.attr(j,i)}g=o;f=n;i=1}});if(i>1){g.attr(j,i)}},setting:{msgboxtype:null,btn_icons:{"新增":"add1","删除":"del1","编辑":"edit1","查询":"search","提交":"ok","保存":"save1","打印":"print","返回":"back"},navTitleParamName:null,messageOnLoading:"数据加载中，请等待....."},version:"1.5.015"}})(jQuery);(function($){$.webDataGrid={defConfig:{width:"100%",height:500,striped:true,defaultSel:true,trselect:true,onSelect:false,onAddRow:false,toolbar:null,btnCondClass:"btn_condition",fixhead:false,hashead:true,sortable:false,filterable:false,idCol:null,idStart:1,print:"print",headclass:"gridheadclass",trclass:null,tdclass:null,thresPage:1000,defSizePage:15,colspan:null,span_dep:null,rowspan:null,nowrap:true},create:function(t,p){if(t.grid){return false}p=$.extend({},this.defConfig,p);if(p.print=="preview"){p.fixhead=false;p.trselect=false;p.onSelect=false;p.striped=false;p.headclass="gridheadclassprint";$(t).addClass("print_class");$(">tbody>tr",t).each(function(){$(this).addClass(p.trclass==null?"print_tr_class":p.trclass);$(">td",$(this)).addClass(p.tdclass==null?"print_td_class":p.tdclass)});$(">thead>tr",t).each(function(){$(this).addClass(p.trclass==null?"print_tr_class":p.trclass);$(">td,>th",$(this)).addClass(p.tdclass==null?"print_td_class":p.tdclass)})}else{if(p.print=="preview"){p.fixhead=false}}var g={initHead:function(t){var gh=$(">thead ",t);var tr1=$("tr:first",t);if(gh.length==0){gh=$("<thead></thead>");gh.append(tr1);$(t).prepend(gh)}var ghth=$(">tr th",gh);if(ghth.length<=0){$(">td",tr1).each(function(){var th=document.createElement("th");th.innerHTML=this.innerHTML;$(th).attr("width",$(this).attr("width"));$(th).attr("class",$(this).attr("class"));$(th).attr("rowspan",$(this).attr("rowspan"));$(th).attr("sortable",$(this).attr("sortable"));$(th).attr("filterable",$(this).attr("filterable"));$(th).attr("colspan",$(this).attr("colspan"));$(th).attr("name_map",$(this).attr("name_map"));$(th).addClass(p.headclass);$(this).replaceWith(th)})}else{ghth.each(function(){ghth.addClass(p.headclass)})}if(typeof($(t).attr("width"))=="undefined"){$(t).attr("width",p.width)}},setBar:function(bar){p.toolbar=bar;$(">tbody tr:first",t).trigger("click")},initBody:function(t){var tbody=$(">tbody ",t);if(tbody.length>0){}else{var tbody=document.createElement("tbody");$("tr ",t).each(function(){$(tbody).append(this)})}},addcol:function(el,op){op=$.extend({ipos:null,width:null,title:null,isappend:true},op);var trH=$("thead>tr",g.top);if(op.ipos==null){op.ipos=$(">th,>td",trH).length-1}trH.each(function(){var tds=$(">td:eq("+op.ipos+"),>th:eq("+op.ipos+")",this);var newtd=$('<th class="'+p.headclass+'" >'+(op.title==null?"新增":op.title)+"</th>");if(op.width!=null){newtd.attr("width",op.width)}if(op.isappend){tds.after(newtd)}else{tds.before(newtd)}});var trs=$(">tbody>tr",g.top);trs.each(function(){var tds=$(">td:eq("+op.ipos+")",this);if(op.isappend){tds.after($("<td></td>").append(el))}else{tds.before($("<td></td>").append(el))}});if(p.fixhead){g.fixhead.adjustWidth()}},appendElements:function(el,op){if(op==null){op={}}var hasR=(op.irow!=null&&(/^\d+$/.test(op.irow)));var rSel=(op.tohead==true)?(hasR?"thead.hashead>tr:eq("+op.irow+")":"thead.hashead>tr"):(hasR?">tbody>tr:eq("+op.irow+")":">tbody>tr");var cSel=(op.icol!=null&&(/^\d+$/.test(op.icol)))?">td:eq("+op.icol+"),>th:eq("+op.icol+")":" >td, >th";var trs=$(rSel,g.top);trs.each(function(){var tds=$(cSel,this);var val=null;if(op.linkid!=null){if(/^\d+$/.test(op.linkid)){val=$(">td:eq("+op.linkid+")",this).text()}else{val=$("#"+op.linkid,this).text()}}var jobj=$(el);if(val!=null){jobj.val(val)}if(op.clear==true){tds.empty()}tds.append(jobj)});if(p.fixhead){g.fixhead.adjustWidth()}},formatgrid:function(t,rowfilter){var trs=(rowfilter==null)?$(">tbody>tr ",t):$(rowfilter,t);trs.each(function(index,e){var trObj=$(this);if(p.idCol!=null){if((index>=(p.idStart-1))){if(!isNaN(p.idCol)&&p.idCol>0){$(">td:eq("+(p.idCol-1)+")",trObj).text((index+1-p.idStart)+1)}else{$("."+p.idCol,trObj).text((index+1-p.idStart)+1)}}}if(p.trselect){trObj.unbind("click").click(function(){$(".trSelected",t).removeClass("trSelected");trObj.toggleClass("trSelected");var id=$(this).attr("btn_condition");if(id==null){id=$("td:first",this).attr("btn_condition")}if(p.toolbar!=null){p.toolbar.refreshbyName(id)}g.currIndex=index;g.selrow=trObj;if(p.onSelect){p.onSelect(g.currIndex,this)}})}if(p.striped){if(index%2!=0){trObj.removeClass("erow").addClass("orow")}else{trObj.removeClass("orow").addClass("erow")}}});if(p.trselect){$(t).bind("keydown",{target:g},function(e){var currTr=e.data.target.selrow;if(e.keyCode==38){currTr.prev().trigger("click");return false}else{if(e.keyCode==40){currTr.next().trigger("click");return false}}})}},setSortable:function(t){var sall=null;if(p.sortable){sall=$(">thead th."+p.headclass,t);sall.attr("sortable")}else{sall=$(">thead th."+p.headclass+"[sortable]",t)}sall.each(function(){var th=$(this);th.append($('<div class="sortby" title="双击排序"></div>'));var sby="sasc,sdesc".split(",");th.hover(function(){var slf=$(this);var sdiv=$("div.sortby",slf);var sorted=sdiv.data("sortedby");slf.addClass("thOver");var newby=(sorted==sby[0])?sby[1]:(sorted==sby[1]?sby[0]:sby[0]);sdiv.removeClass(sby[0]).removeClass(sby[1]).addClass(newby);sdiv.css({left:slf.offset().left,bottom:slf.offset().bottom,width:slf.width()})},function(){var slf=$(this);var sdiv=$("div.sortby",slf);var lastSortby=sdiv.data("sortedby");slf.removeClass("thOver");sdiv.removeClass(sby[0]).removeClass(sby[1]).addClass(lastSortby)}).dblclick(function(){var slf=$(this);var sdiv=$("div.sortby",slf);var by=sdiv.data("sortedby")==sby[0]?sby[1]:sby[0];g.updateSortHeadCss(slf,by,sby);g.startSort(t,slf.index(),by)})})},startSort:function(t,idxCol,by){var trs=$(">tbody>tr",t);var tds=$(">tbody>tr>td:nth-child("+(idxCol+1)+")",t);var isdigt=true;tds.each(function(){var s=tds.text();isdigt=/^[-+]?\d*$/.test($.trim(s.replace(/[,.']/g,"")));if(isdigt==false){return false}});trs.sort(function(a,b){var aval=$("td:eq("+idxCol+")",a).text();var bval=$("td:eq("+idxCol+")",b).text();if(isdigt==true){return by=="sasc"?aval-bval:bval-aval}else{return by=="sasc"?aval.localeCompare(bval):-(aval.localeCompare(bval))}});var bd=$(">tbody",t)[0];trs.each(function(){bd.appendChild(this)})},updateSortHeadCss:function(th,by,sby){var slf=th;var sdiv=$("div.sortby",slf);sdiv.data("sortedby",by);slf.addClass("sorted");if(by==sby[1]){sdiv.addClass(sby[1]).removeClass(sby[0])}else{sdiv.addClass(sby[0]).removeClass(sby[1])}var oh=slf.siblings(".sorted");oh.removeClass("sorted");$("div.sortby",oh).removeClass(sby[0]).removeClass(sby[1]).data("sortedby",null)},setFilterable:function(t){var sall=null;if(p.filterable){sall=$(">thead>tr>th."+p.headclass,t);sall.attr("filterable")}else{sall=$(">thead>tr>th."+p.headclass+"[filterable]",t)}sall.each(function(){var th=$(this);var fdiv=$('<div class="filterdiv nofiltered" style="display:none;" title="设置条件过滤"><div></div></div>');var flts=$('<div class="filters"  style="display:none;"></div>');var fltb=$('<div class="filtertb" cellspacing="0" cellpadding="0"></div>');th.append(fdiv);th.append(flts);flts.append(fltb);var fops=[];$(">tbody>tr>td:nth-child("+(th.index()+1)+")",t).each(function(){fops.push($.trim($(this).text()))});fops=$.unique(fops);fops.sort(function(a,b){return a.localeCompare(b)});var divops=[];$.each(fops,function(){divops.push('<div class="afilter">');divops.push('<div class="divkey"><input type="checkbox"   checked="checked" value="');divops.push(this);divops.push('"  ></div> <div class="divval">');divops.push(this);divops.push("</div></div>")});fltb.append(divops.join("").toString());$(":checkbox",fltb).bind("click",{colid:th.index()},function(e){var box=$(this);$(t).setGridDisplayRow({index:e.data.colid,text:box.val(),rowfilter:null,tohide:!box.is(":checked")});if($(":checkbox:not(:checked)",fltb).length>0){fdiv.removeClass("nofiltered").addClass("filtered")}else{fdiv.removeClass("filtered").addClass("nofiltered")}}).dblclick(function(){return false});$("div",fltb).dblclick(function(){return false});th.hover(function(){var slf=$(this);var fdiv=$(">div.filterdiv",slf);fdiv.css({left:slf.offset().left,top:slf.offset().top});fdiv.show();$(">div.filterdiv",slf.siblings(".thOver")).hide().siblings(".filters").hide()},function(){var slf=$(this);var fdiv=$(">div.filterdiv",slf);fdiv.hide().siblings(".filters").hide();$(">div.filterdiv.filtered",slf).show()});fdiv.click(function(){var slf=$(this);var fs=slf.siblings(".filters");if(fs.is(":hidden")){fs.css({left:slf.offset().left,top:slf.offset().bottom}).show()}else{fs.hide()}return false})})}};$(t).hide();var to=$(t);to.addClass("datagrid_gridtb");if(to.attr("id")==null){to.attr("id","datagrid_gridtb_"+($("table.datagrid_gridtb").length+1))}g.top=to;if(p.hashead){g.initHead(t)}$("thead",to).addClass(p.hashead?"hashead":"nohead");g.initBody(t);if(to.attr("tabindex")==undefined){to.attr("tabindex",1)}if($(">tbody>tr",t).length>=p.thresPage){g.page=$.gridPaginate(t,{sizeofPage:p.defSizePage,tip_message:p.page_message});g.page.initPage()}g.formatgrid(t);to.show().attr({cellPadding:0,cellSpacing:0,border:0});t.p=p;t.grid=g;if(p.hashead&&p.fixhead){g.fixhead=$.gridFixedHead(t);g.top=g.fixhead.tdiv}if(p.defaultSel){$(">tbody tr:first",t).trigger("click")}to.bind("onAddRow",function(e,tr){g.formatgrid(this);if($(">tbody>tr",t).length>=p.thresPage){g.page=$.gridPaginate(t,{sizeofPage:p.defSizePage,tip_message:p.page_message})}if(g.page!=null){g.page.initPage()}if(t.p.onAddRow){t.p.onAddRow(tr)}});to.bind("onDelRow",function(tr){g.formatgrid(this)});to.bind("onReFormat",function(e,rowfilter){g.formatgrid(this,rowfilter)});g.setSortable(t);g.setFilterable(t);if(p.colspan){$.each(p.colspan,function(){$.webUtil.tableSpanSame(t,this,"colspan",p.span_dep)})}if(p.rowspan){$.each(p.rowspan,function(){$.webUtil.tableSpanSame(t,this,"rowspan",p.span_dep)})}return t}};$.fn.datagrid=function(p){return this.each(function(){$.webDataGrid.create(this,p)})};$.fn.setGridDisplayRow=function(where){var def={index:-1,text:null,rowfilter:null,btn_condition:null,tohide:true};if(where==null){return}where=$.extend(def,where);var trs=$(">tbody>tr",this);if(where.index>=0){var tds=$(">tbody>tr>td:nth-child("+(where.index+1)+")",this);tds.each(function(idx){var atd=$(this);if($.trim(atd.text())==where.text){var atr=$(trs[idx]);where.tohide?atr.hide():atr.show()}})}else{if(where.rowfilter!=null){var trs=$(where.rowfilter,this);where.tohide?trs.hide():trs.show()}else{if(where.btn_condition!=null){var alltr=$(">tbody>tr",this);if(where.btn_condition==""){alltr.show()}else{alltr.hide();var btn_td=$('>tbody>tr>td[btn_condition="'+where.btn_condition+'"]',this);btn_td.each(function(){var atr=$(this).closest("tr");atr.show()})}}}}$(this).trigger("onReFormat",">tbody>tr:visible")};$.fn.loadData=function(op){var $grid=$(this);var op2=$.extend({},op);$grid.find("tbody>tr").remove();var nMap=[];$grid.find("thead>tr>th").each(function(){var n=$(this).attr("name_map");nMap.push($.trim(n))});var tr=[];var tm=setTimeout(function(){try{tr=[];var ss=op.success;var getfun=function(jsdata){if(jQuery.isFunction(ss)){ss.call($,jsdata)}if(op.onPreLoad!=null){op.onPreLoad(jsdata,op)}var rs=jsdata.result;if(op.resultName!=undefined){try{rs=eval("jsdata."+op.resultName)}catch(e){rs=null}}$.each(rs,function(key,val){tr.push("<tr>");$.each(nMap,function(n,v){tr.push("<td>");if(v!=null){var rval=val[v];if(op.setCellVal){rval=op.setCellVal(n,v,val)}tr.push(rval)}tr.push("</td>")});tr.push("</tr>")});$grid.addrow(tr.join("").toString(),null,null);var pi=jsdata.pageInfo;if(op.pageInfoName!=undefined){try{pi=eval("jsdata."+op.pageInfoName)}catch(e){pi=null}}if(pi!=null){var page=$.gridPaginate($grid,{tip_message:""});page.initPage({totalSize:pi.totalSize,sizeofPage:pi.pageSize,currPage:pi.currPage,applyTo:op.applyTo,showFirst:false});page.showPage=function(n){if(n>this.op.totalPages){n=this.op.totalPages}this.setRequestPage(n);$grid.loadData(op2)};page.genNav(page.op.currPage);$grid[0].page=page}if(op.loadFinish){op.loadFinish(jsdata,op)}};op=$.extend({type:"POST",dataType:"json",cache:false,success:getfun},op);op.success=getfun;$.webUtil.submitByAjax(op)}catch(e){alert("数据加载异常！"+e)}finally{$grid.unmask()}tm=null},50);$grid.setmask({msg:$.webUtil.setting.messageOnLoading})};$.fn.addrow=function(tr,ipos,ideps,ref){return this.each(function(){var bdy=$(">tbody",this);var depsrow=$(">tr:last",bdy);if(ideps!=null){depsrow=$(">tr:eq("+(ideps-1)+")",bdy)}var newtr=(tr!=null)?tr:$("<tr>"+depsrow.html()+"</tr>");if(ipos!=undefined){$(">tr:eq("+(ipos-1)+")",bdy).after(newtr)}else{bdy.append(newtr)}if(ref!=false){$(this).trigger("onAddRow",newtr)}})};$.fn.delrow=function(idel){return this.each(function(){if($(">tbody>tr:visible",this).length<1){return}var row=$(">tbody>tr:last",this);if(idel!=null){row=$(">tbody>tr:eq("+(idel-1)+")",this)}row.remove();$(this).trigger("onDelRow")})};$.fn.delrow=function(idel,retentionRows){return this.each(function(){if($(">tbody>tr:visible",this).length<(retentionRows+1)){return}var row=$(">tbody>tr:last",this);if(idel!=null){row=$(">tbody>tr:eq("+(idel-1)+")",this)}row.remove();$(this).trigger("onDelRow")})};$.fn.getCurrIndex=function(){if($(this).get(0).grid==null){return undefined}return $(this).get(0).grid.currIndex};$.fn.addcol=function(el,op){return this.each(function(){$(this).get(0).grid.addcol(el,op)})};$.fn.appendElements=function(el,op){if(op==null){op={}}return this.each(function(){$(this).get(0).grid.appendElements(el,op)})};$.fn.gridRowspan=function(column,idep){$.webUtil.tableSpanSame(this,column,"rowspan",idep)};$.fn.gridColspan=function(rownum,idep){$.webUtil.tableSpanSame(this,rownum,"colspan",idep)};$.gridPaginate=function(t,opt){var pfix="gridPaginate_";var id_pg=pfix+"navigator";var id_info=pfix+"paging_info";var id_f=pfix+"firstpage";var id_p=pfix+"prevpage";var id_n=pfix+"nextpage";var id_e=pfix+"endpage";var id_s=pfix+"sizePerPage";var id_j=pfix+"jumper";opt=$.extend(true,{totalSize:0,currPage:1,totalPages:0},$.gridPaginate.defaults,opt);var pg={op:opt,tb:t,eid:$(t).attr("id"),divNav:null,allRows:null,initPage:function(iop){if(iop==null){iop={}}this.divNav=$("<div id='"+id_pg+this.eid+"' class='"+id_pg+"' align='right' ></div>");if(iop.totalSize==null){this.allRows=$(">tbody > tr",this.tb);this.op.totalSize=this.allRows.length}else{this.op.totalSize=iop.totalSize}if(iop.applyTo==null){$(this.tb).next("#"+id_pg+this.eid).remove();$(this.tb).after(this.divNav)}else{$("#"+id_pg+this.eid,iop.applyTo).remove();iop.applyTo.append(this.divNav)}if(iop.sizeofPage!=null){this.op.sizeofPage=iop.sizeofPage}var prePages=Math.round(this.op.totalSize/this.op.sizeofPage);var tPages=(prePages*this.op.sizeofPage<this.op.totalSize)?prePages+1:prePages;this.op.totalPages=tPages;if(iop.currPage!=null){this.op.currPage=iop.currPage}if(iop.showFirst==null||iop.showFirst==true){this.showPage(1)}},showPage:function(n){if(n>this.op.totalPages){n=this.op.totalPages}if(n==0){return}var startIndex=(n-1)*this.op.sizeofPage;var endIndex=(startIndex+this.op.sizeofPage-1);for(var i=0;i<this.allRows.length;i++){if(i>=startIndex&&i<=endIndex){$(this.allRows[i]).show()}else{$(this.allRows[i]).hide()}}this.divNav.empty();var div=this.getNavigationHtml(n);this.divNav.append(div);this.op.currPage=n},genNav:function(n){if(n>this.totalPages){n=this.totalPages}var div=this.getNavigationHtml(n,true);this.divNav.empty();this.divNav.append(div)},setRequestPage:function(ind,sizeofP){if(this.op.inputName!=null){this.divNav.find("input[name='"+this.op.inputName.currPageName+"'").val(ind);if(sizeofP!=null){this.op.sizeofPage=sizeofP}this.divNav.find("input[name='"+this.op.inputName.sizeOfPageName+"'").val(this.op.sizeofPage)}},indexofPage:function(obj){var rIndex=obj.closest("tr").index()+1;var i1=Math.round(rIndex/this.op.sizeofPage);var indexOf=(i1*this.op.sizeofPage<rIndex)?i1+1:i1;return indexOf},getNavigationHtml:function(curr,isinput){var rSum=this.op.totalSize;if(curr>this.op.totalPages){curr=this.op.totalPages}var nav=[];nav.push("<div>");nav.push("<span id='"+id_info+this.eid+"'>");if(this.op.totalPages>1){nav.push(this.op.tip_message)}nav.push("第"+curr+"页/共"+this.op.totalPages+"页&nbsp;&nbsp;总计"+rSum+"条记录&nbsp;&nbsp;");nav.push("</span>");nav.push("<span >");nav.push("每页大小:");if(this.op.sizesofPage!=null){nav.push("<select id='"+id_s+this.eid+"'>");if($.inArray(this.op.sizeofPage,this.op.sizesofPage)<0){this.op.sizesofPage.push(this.op.sizeofPage);this.op.sizesofPage.sort(function(a,b){return a-b})}for(var i=0;i<this.op.sizesofPage.length;i++){var sel=(this.op.sizeofPage==this.op.sizesofPage[i])?"selected":"";nav.push("<option value='"+this.op.sizesofPage[i]+"' "+sel+">"+this.op.sizesofPage[i]+"</option>")}nav.push("</select>")}else{nav.push(this.op.sizeofPage+"&nbsp;&nbsp;&nbsp;&nbsp;")}nav.push("</span>");nav.push("<span class='gridPaginate_navigate'>");nav.push("<a id='"+id_f+this.eid+"' href='#'>首页</a>&nbsp;");if(curr<=1){nav.push("上一页&nbsp;")}else{nav.push("<a id='"+id_p+this.eid+"'  href='#'>上一页</a>&nbsp;")}if(curr>=this.op.totalPages){nav.push("下一页&nbsp;")}else{nav.push("<a id='"+id_n+this.eid+"'  href='#'>下一页</a>&nbsp;")}nav.push("<a id='"+id_e+this.eid+"'  href='#'>末页</a>&nbsp;");nav.push("</span>");if(this.op.totalPages>2){nav.push("跳至:<input type='text' id='"+id_j+this.eid+"' name='"+id_j+this.eid+"' size='3' value='"+curr+"'/> ")}if(isinput&&this.op.inputName!=null){nav.push("<input type='hidden' name='");nav.push(this.op.inputName.currPageName);nav.push("' value='");nav.push(curr);nav.push("' />\n");nav.push("<input type='hidden' name='");nav.push(this.op.inputName.sizeOfPageName);nav.push("' value='");nav.push(this.op.sizeofPage);nav.push("' />\n");nav.push("<input type='hidden' name='");nav.push(this.op.inputName.isFlipName);nav.push("' value='");nav.push(this.op.inputName.isFlipName);nav.push("' />\n")}nav.push("</div>");var divN=$(nav.join("").toString());var sId="#";$(sId+id_f+this.eid,divN).click(function(){pg.showPage(1)});$(sId+id_p+this.eid,divN).click(function(){pg.showPage(parseInt(pg.op.currPage)-1)});$(sId+id_n+this.eid,divN).click(function(){pg.showPage(parseInt(pg.op.currPage)+1)});$(sId+id_e+this.eid,divN).click(function(){pg.showPage(pg.op.totalPages)});$(sId+id_s+this.eid,divN).change(function(){pg.op.sizeofPage=parseInt($(this).val());var prePages=Math.round(pg.op.totalSize/pg.op.sizeofPage);var tPages=(prePages*pg.op.sizeofPage<pg.op.totalSize)?prePages+1:prePages;pg.op.totalPages=tPages;pg.showPage(pg.op.currPage)});$(sId+id_j+this.eid,divN).keydown(function(e){var keyCode=e.which?e.which:e.keyCode;if(e.keyCode==13){var topage=parseInt($(this).val());pg.showPage(topage)}});return divN}};return pg};$.gridPaginate.defaults={sizeofPage:20,sizesofPage:[5,10,25,50,100,500,1000],tip_message:"存在未显示的数据... ...&nbsp;&nbsp;",ignoreRows:[],inputName:{currPageName:"HTML_CURR_PAGE_NAME",sizeOfPageName:"HTML_PAGE_SIZE_NAME",isFlipName:"HTML_PAGE_FLIP_FLAG"}};$.gridFixedHead=function(t){var fh_cl="fixhead_hdiv";var fb_cl="fixhead_bdiv";var ht_cl="fixhead_headtb";var bt_cl="fixhead_bodytb";var grid_cl="datagrid_gridtb";var fhead={tb:null,tdiv:null,hdiv:null,bdiv:null,fixhead:function(tbl,h){this.tb=$(tbl);this.tdiv=$("<div class='"+grid_cl+"'><div class='"+fh_cl+"'></div><div class='"+fb_cl+"'></div></div>");this.hdiv=$("."+fh_cl,this.tdiv);this.bdiv=$("."+fb_cl,this.tdiv);this.tb.before(this.tdiv);var hTable=document.createElement("table");$(hTable).addClass(ht_cl).attr("width","100%").attr({cellPadding:0,cellSpacing:0,border:0});var oldhead=$("thead:first",this.tb);this.hdiv.append($(hTable).append(oldhead));this.tb.removeClass(grid_cl).addClass(bt_cl).attr({width:"100%"});this.bdiv.append(this.tb);this.bdiv.css({height:$(this.tb).attr("height")!=null?this.tb.attr("height"):this.tb[0].p.height,"overflow-x":"hidden","overflow-y":"auto"}).hover(function(){fhead.adjustWidth()});this.tb.removeAttr("height");$(window).resize(function(){this.adjustWidth()});this.adjustWidth()},adjustWidth:function(){if(!this.tb[0].p.fixhead){return}var gd=this.tdiv;var p=this.tb[0].p;var hsum=0;var hbd=0;var s_cl=".";var bdiv=$(s_cl+fb_cl,gd).get(0);var iw=parseInt($(bdiv).css("borderLeftWidth"));var iwidth=(isNaN(iw)?0:iw);iw=parseInt($(bdiv).css("borderRightWidth"));iwidth+=(isNaN(iw)?0:iw);var scrWidth=bdiv.offsetWidth-iwidth-bdiv.clientWidth;if($.browser.msie&&$.browser.version<=7){scrWidth=0}var hed=$(s_cl+fb_cl+" tbody:first tr:first td",gd);hed.each(function(index,e){var pth=$(s_cl+fh_cl+" thead:first tr ."+p.headclass+":eq("+index+")",gd).get(0);if(pth!=null){var hW=parseInt(pth.clientWidth);if(index<hed.length-1){$(this).attr("width",hW)}else{$(this).attr("width",hW-scrWidth)}hsum+=hW;hbd+=parseInt($(pth).css("borderWidth"))}});if($.browser.msie&&$.browser.version<=7){$(s_cl+fb_cl,gd).css("width",hsum+hbd+scrWidth)}}};fhead.fixhead(t);return fhead}})(jQuery);(function(a){a.fn.extend({webButton:function(b){var c=function(){return a.extend({},a.fn.webButton.defaults)};var d=a(this);d.each(function(){var g=c();var i=a(this);if(i.hasClass(g.btn_class)==true){return i}if(i.attr("btn_href")!==undefined){g.btn_href=i.attr("btn_href")}if(i.attr("force")!==undefined){g.force=true}if(i.attr("istip")!==undefined){g.istip=i.attr("istip")=="1"?true:false}if(i.attr("issubmit")!==undefined){g.issubmit=i.attr("issubmit")=="1"?true:false}if(i.attr("ischeck")!=undefined){g.ischeck=i.attr("ischeck")=="1"?true:false}if(i.attr("ismask")!=undefined){g.ismask=i.attr("ismask")=="1"?true:false}if(i.attr("popup")!==undefined){g.popup=true}if(i.attr("enableIcon")!=undefined){g.enableIcon=i.attr("enableIcon")=="0"?false:true}if(i.attr("icon")!=undefined){g.icon=i.attr("icon")}if(g.formobj==null){g.formobj=a(a("form")[0])}if(g.maskobj==null){g.maskobj=a("body")}var l=a.extend({},g,b||{});i.data("btn_setting",l);var h=a('<div class="btn_pic"></div>').addClass(g.pic_l);var k=a('<span class="btn_pic"></span>').append(i.html()).addClass(g.pic_r);if(l.enableIcon){var f=a('<span class="btn_icon"></span>');k.prepend(f);if(l.icon!=null){f.addClass(l.icon)}else{var e=a.trim(k.text());var j=a.webUtil.setting.btn_icons[e];if(j==null){j=a.webUtil.setting.btn_icons[e.substring(0,2)]}f.addClass((j==null)?"btn_icon_def":"icon_"+j)}}i.empty();i.append(a(h).append(k)).addClass(g.btn_class);i.hover(function(){a("."+g.pic_l,this).addClass(g.pic_lo_c);a("."+g.pic_r,this).addClass(g.pic_ro_c)},function(){a("."+g.pic_l,this).removeClass(g.pic_lo_c);a("."+g.pic_r,this).removeClass(g.pic_ro_c)});if(g.enableActiveClass){i.mousedown(function(m){a("."+g.pic_l,this).addClass(g.pic_la_c);a("."+g.pic_r,this).addClass(g.pic_ra_c)}).mouseup(function(m){a("."+g.pic_l,this).removeClass(g.pic_la_c);a("."+g.pic_r,this).removeClass(g.pic_ra_c)}).mouseout(function(m){a("."+g.pic_l,this).removeClass(g.pic_la_c);a("."+g.pic_r,this).removeClass(g.pic_ra_c)})}i.bind("click",function(n){var m=a(this).data("btn_setting");if(m!=null&&m.btn_href!=null){if(m.issubmit==true){a.webUtil.submitByButton({button:i,url:m.btn_href,target:m.popup?"_blank":""});return false}else{if(m.popup){a.webUtil.open(m.btn_href,{widths:null,heights:null,popup:true})}else{n.preventDefault();a.webUtil.gotoPage(m.btn_href)}}}})});return d},BtnToolBar:function(g){g=a.extend({hasborder:false,bcls:"web-ui-btn_toolbar"},g);var f=a(this);if(f.hasClass(g.bcls)==true){return}f.addClass(g.bcls);var d=a("button",f).webButton();var c={refreshbyName:function(e){var b="";if(this.btnCond!=null){b=a("#"+e,this.btnCond).text()}else{b=a(".btns_info",this).text()}if(b==null){b=""}b=b.split(",");a(this.btns).each(function(){if(a(this).attr("force")!==undefined){return}if(a.inArray(a.trim(a(this).text()),b)>=0){a(this).show()}else{a(this).hide()}})},btns:d};c.btnCond=a(".btn_condition",f);c.refreshbyName("condition_null");f.show();return c}});a.fn.webButton.defaults={btn_href:null,istip:false,issubmit:true,ischeck:true,popup:false,force:false,formobj:null,maskobj:null,ismask:true,enableIcon:true,enableActiveClass:true,icon:null,btn_class:"web-ui-btn",pic_l:"pic-l",pic_r:"pic-r",pic_lo_c:"pic-l-o",pic_ro_c:"pic-r-o",pic_la_c:"pic-l-a",pic_ra_c:"pic-r-a"};a.fn.PicButton=a.fn.webButton})(jQuery);(function(a){a.fn.extend({webTabpanel:function(b){var c={onChanged:null,tabpath:"/div/div div",ttCls:"webtab_title_container/webtab_titles_panel/webtab_titles/webtab_atitle/webtab_title",ccCls:"webtab_acontent/webtab_content"};if(b){jQuery.extend(c,b)}a(this).each(function(){var h=c.tabpath.split("/");var m=c.ttCls.split("/");var g=c.ccCls.split("/");a(h).each(function(o){h[o]=this.split(/\s+/)});var n=1;var d=a(this);d.addClass("webtabpanel");if(c.width!=null){d.width(c.width)}if(c.height!=null){d.height(c.height)}var l=d.find(">"+h[n][0]);l.hide();var i=l.find(">"+h[n+1][0]+":eq(0)").addClass(m[4]);var j=l.find(">"+h[n+1][1]+":eq(1)").addClass(g[1]);var e=a("<div ></div>").addClass(m[0]);var k="tab_content";var f={showTab:function(o){var r=e.find(".active");if(r.length>0){r.removeClass("active");r.data(k).parent().hide()}var q=e.find("."+m[3]+":eq("+o+")");q.addClass("active");var p=q.data(k);p.parent().show();f.currActived=o},initTitle:function(o){var r=a("<div ></div>").addClass(m[1]);var p=a("<ul ></ul>").addClass(m[2]);var q=0;o.each(function(t){var s=a("<li></li>").addClass(m[3]);s.append(a(this));p.append(s);s.data(k,a(j[t]));if(a(this).attr("actived")!=null){q=t}});r.append(p);e.append(r).append("<div class='cleanfloat'></div><div class='webtab_spacer '></div>");d.prepend(e);l.addClass(g[0]);f.showTab(q);e.delegate("."+m[3],"click",function(){var t=a(this).index();var s=f.currActived;f.showTab(t);if(c.onChanged!=null){c.onChanged(s,t)}})}};f.initTitle(i);a(this).data("tab",f)});return a(this)}});a.fn.setActiveTab=function(b){var c=a(this).data("tab");if(c!=null){c.showTab(b)}};a.fn.getActiveTab=function(){var b=a(this).data("tab");if(b!=null){return b.currActived}}})(jQuery);(function(a){a.fn.extend({webPanel:function(b){var c={width:null,title:"",hasHead:true,collapsable:false,dir:1,resizable:true,ttCls:"webpanel/webpanel_header/webpanel_title/webpanel_tool/webpanel_content/pup/pdown"};if(b){jQuery.extend(c,b)}a(this).each(function(){var h=c.ttCls.split("/");var m=a(this);m.addClass(h[0]);var i=m.attr("title");if(c.width!=null){m.width(c.width)}m.wrapInner(a("<div></div>").addClass(h[4]));m.prepend(a("<div></div>").addClass(h[1]));var n=m.find(">."+h[4]);var g=m.find(">."+h[1]);g.append(a("<div></div>").addClass(h[2])).append(a("<div></div>").addClass(h[3]));var f=g.find(">."+h[2]);f.text(i);var d=c.height;var l=m[0].style.height;if(d==null&&l!=null&&l!=""){d=m.height()}if(!isNaN(d)){m.outerHeight(d);var j=m.height()-g.outerHeight();n.height(j);if(a.browser.msie){}else{n.height(j-(n.outerHeight()-n.height()))}}else{n.height("100%")}m.css("height","");if(c.collapsable){var k=g.find(">."+h[3]);var e=k.append(a("<a href='#'></a>").addClass("panelbtn").addClass(h[5]));e.bind("click",{target:this},function(q){var p=g.height();var o=m.height();if(o>p){c.old_h1=o;a(".panelbtn",this).removeClass(h[5]).addClass(h[6]);m.animate({height:p})}else{a(".panelbtn",this).removeClass(h[6]).addClass(h[5]);m.animate({height:c.old_h1})}})}if(c.resizable){m.webResizable()}if(!c.hasHead){g.hide()}});return a(this)}})})(jQuery);(function(a){a.fn.extend({AccordionMuti:function(e){var m={hpath:"/h3 div/h3 div/p",hClass:"/multi-accordion-head1 multi-accordion-level1/multi-accordion-head2  multi-accordion-level2/multi-accordion-head3",pClass:"/multi-accordion-padding1/multi-accordion-padding2/multi-accordion-padding3",aClass:"/multi-accordion-active/multi-accordion-active/multi-accordion-active3",target:"_blank",icons:{header:"multi-accordion-icon-circle-arrow-e",headerSelected:"multi-accordion-icon-circle-arrow-s"}};if(e){jQuery.extend(m,e)}var t=m.hpath.split("/");var l=m.pClass.split("/");var k=m.hClass.split("/");var p=m.aClass.split("/");a(t).each(function(i){t[i]=this.split(/\s+/)});a(k).each(function(i){k[i]=this.split(/\s+/)});var o=a(this);o.addClass("multi-accordion");var h=o;var b=t.length;function n(i){a(this).removeClass(k[i.data.level][0]).addClass("multi-accordion-active")}function j(i){a(this).removeClass("multi-accordion-active").addClass(k[i.data.level][0])}for(var r=1;r<b;r++){var g=h.find(">"+t[r][0]);g.addClass(k[r][0]);g.bind("mouseover",{level:r},n);g.bind("mouseout",{level:r},j);g.addClass(l[r]);if(r+1<b){var q=h.find(">"+t[r][1]);q.addClass(k[r][1]);q.hide();c(g,t[r][1]);d(g);h=q}else{var f=g.find(" > a").attr("target",m.target);g.click(function(){a(this).siblings("."+p[3]).removeClass(p[3]);a(this).addClass(p[3])})}}var v=o.closest("form");if(v.length>0){a("p",o).click(function(){var i=a("a",a(this)).attr("href");v.attr("target",m.target);v.attr("action",i);v.submit();return false})}var u=a("[def_expanded]",o);u.closest(t[1][1]).prev(t[1][0]).trigger("click");u.trigger("click");function c(s,i){s.click(function(){var x=(a(this).next(i).index())-1;a(this).siblings(i+":not(:eq("+x+"))").slideUp();a(this).siblings().children("."+m.icons.headerSelected).removeClass(m.icons.headerSelected);var w=a(this).next();w.slideToggle(300);a(this).children(".multi-accordion-icon").toggleClass(m.icons.headerSelected)})}function d(s){var i=m;if(i.icons){a("<span>&nbsp;&nbsp;&nbsp;</span>").addClass("multi-accordion-icon "+i.icons.header).prependTo(s)}}}})})(jQuery);(function(a){a.webValidator={opName:"valid_options",defaults:{type:"text",empty:true,min:0,max:999999,onErrMsg:"",onShowMsg:"",regExp:"",group:null,ischeck:true,maincheck:true,linkbox:null,wideWord:true},onError:function(c,f,g){if(!c.is(":disabled")){c.focus()}var b=c.attr("title");var d=g.onErrMsg==""?f:g.onErrMsg;if(b!=null){d="["+b+"]&nbsp;"+d}a.webValidator.tipTool.showMessage(c,d,"icon_no");return false},validSize:function(b,c){if(typeof(c.min)!="undefined"&&b.length<c.min){return false}if(typeof(c.min)!="undefined"&&b.length>c.max){return false}return true},validType:function(d,e){var b=a.webValidator.dataType[e.type];if(b==undefined){return false}var c=(b.regex==undefined||b.regex=="")?e.regExp:b.regex;if(c==undefined||c==""){return false}return(new RegExp(c,"i")).test(d)},validValue:function(e,g){var c=true;var b=g.type;switch(b){case"date":case"datetime":c=a.webValidator.util.isDate(e);e=new Date(Date.parse(e.replace(/-/g,"/")));var f=g.min,d=g.max;if(c&&a.webValidator.util.isDate(f)){f=new Date(Date.parse(f.replace(/-/g,"/")))}if(c&&a.webValidator.util.isDate(d)){d=new Date(Date.parse(d.replace(/-/g,"/")))}if((typeof(f)=="object")&&e<f){c=false}if((typeof(d)=="object")&&e>d){c=false}break;case"number":e=(new Number(e)).valueOf();c=!isNaN(e)}return c},checkValid:function(b){var c=a.webValidator.getOption(b);if(c==null){alert("无法取得元素的验证配置信息！");return false}return a.webValidator.checkValidBy(b,c)},checkValidBy:function(g,i){var l=g[0];var b=l.type;if(i.linkbox!=null){var h=a(':checkbox[name="'+i.linkbox+'"]',g.closest("tr"));if(h!=null&&h.length>0){i.ischeck=h[0].checked==true?true:false}}var f=i.ischeck;if(f==false||i.type==null||i.type==""||i.maincheck==false){return true}var j=i.empty;var d=(g.val()==i.onShowMsg)?"":g.val();var m=a.webValidator.dataType[i.type];if(m==undefined){alert("not support datatype 不支持的数据类型检查,type="+i.type);return false}var k=0;switch(b){case"text":case"hidden":case"password":case"textarea":case"file":if(j&&(d==null||d=="")){if(g.attr("value")==i.onShowMsg){g.val("")}return true}if(!this.validSize(d,i)&&m!="date"){return this.onError(g,"输入长度错误，有效长度:"+i.min+"～"+i.max,i)}if(!this.validType(d,i)){return this.onError(g,"输入内容类型错误，请输入:"+m.title,i)}if(!this.validValue(d,i)){return this.onError(g,"输入的值错误，正确的值为:"+i.min+"～"+i.max,i)}break;case"checkbox":case"radio":if(j){return true}if(i.maincheck==null||i.maincheck==false){return true}var c=i.group!=null?"[v_group='"+i.group+"']":"[name='"+g.attr("name")+"']:not('[v_group]')";a("input[type='"+b+"']"+c).each(function(e,n){if(n!=l){a.webValidator.setOption(a(this),{maincheck:false})}if(n.checked==true){k+=1}});if(k<i.min){return this.onError(g,"请至少选择:"+i.min+"项",i)}if(k>i.max){return this.onError(g,"请最多选择:"+i.max+"项",i)}break;case"select-one":if(j){return true}if(l.options[l.options.selectedIndex].value.length<1){return this.onError(g,"请至少选择1项",i)}break;case"select-multiple":if(j){return true}k=a("select[name="+l.name+"] option:selected").length;if(k<i.min){return this.onError(g,"请至少选择:"+i.min+"项",i)}if(k>i.max){return this.onError(g,"请最多选择:"+i.max+"项",i)}break;default:return this.onError(g,"未取到元素类型，请检查元素标签",i)}return true},setOption:function(f,e){var g=a.webValidator.getOption(f);if(g==null){return null}a.extend(g,e);if(g.empty!=null&&g.empty==false&&g.min==0){g.min=1}f.data(a.webValidator.opName,g);var d=f[0];var b=d.tagName.toLowerCase();var c=g.onShowMsg;if((c!=null&&c!="")&&(b=="input"||b=="textarea")){a.webValidator.tipTool.showTipInContent(f,c)}if(g.type=="date"){f.webDatepicker()}return g},getOption:function(f){if(f==null||f.length==0){return null}var g=f.data(a.webValidator.opName);if(g==null){g={};a.extend(g,a.webValidator.defaults);var e=f.attr("v_type");if(e!=null){g.type=e}if(g.type=="date"){g.min="不限";g.max="不限"}var d=f.attr("v_ischeck");if(d!=null){g.ischeck=((d=="0")?false:true)}var h=f.attr("v_empty");if(h!=null){g.empty=((h=="1")?true:false)}var k=f.attr("v_min");if(k!=null){g.min=k}var j=f.attr("v_max");if(j!=null){g.max=j}var i=f.attr("v_onShowMsg");if(i!=null){g.onShowMsg=i}var h=f.attr("v_onErrMsg");if(h!=null){g.onErrMsg=h}var l=f.attr("v_group");if(l!=null){g.group=l}var b=f.attr("v_regExp");if(b!=null){g.regExp=b}if(g.empty==false&&g.min==0){g.min=1}var c=f.attr("v_linkbox");if(c!=null){g.linkbox=c}}return g},getFormElements:function(j){var b=null;var i=j.find(":checkbox");var h=j.find(":radio");var g=j.find(":text");var f=j.find(":password");var e=j.find(":file");var d=j.find("select");var c=j.find("textarea");if(g.length<500&&c.length<500){return j.find(":text,:checkbox,:radio,:password,:file,select,textarea")}var b=a.merge(i,h);b=a.merge(b,g);b=a.merge(b,f);b=a.merge(b,e);b=a.merge(b,d);b=a.merge(b,c);return b},util:{aCity:{11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},isCardID:function(b){var e=0;var f="";if(!/^\d{17}(\d|x)$/i.test(b)){return"身份证长度或格式错误"}b=b.replace(/x$/i,"a");if(this.aCity[parseInt(b.substr(0,2))]==null){return"身份证地区非法"}sBirthday=b.substr(6,4)+"-"+Number(b.substr(10,2))+"-"+Number(b.substr(12,2));var g=new Date(sBirthday.replace(/-/g,"/"));if(sBirthday!=(g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate())){return"身份证上的出生日期非法"}for(var c=17;c>=0;c--){e+=(Math.pow(2,c)%11)*parseInt(b.charAt(17-c),11)}if(e%11!=1){return"身份证号非法"}return true},isTime:function(c){var b=c.match(/^(\d{1,2})(:)?(\d{1,2})\2(\d{1,2})$/);if(b==null){return false}if(b[1]>24||b[3]>60||b[4]>60){return false}return true},isDate:function(e){if(typeof(e)!="string"){return false}var b=e.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(b==null){return false}var c=new Date(b[1],b[3]-1,b[4]);return(c.getFullYear()==b[1]&&(c.getMonth()+1)==b[3]&&c.getDate()==b[4])},isDateTime:function(f){var b=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;var c=f.match(b);if(c==null){return false}var e=new Date(c[1],c[3]-1,c[4],c[5],c[6],c[7]);return(e.getFullYear()==c[1]&&(e.getMonth()+1)==c[3]&&e.getDate()==c[4]&&e.getHours()==c[5]&&e.getMinutes()==c[6]&&e.getSeconds()==c[7])}}};a.fn.setValidator=function(b){return this.each(function(g){var c=a(this).get(0).tagName;var f=null;if(c=="FORM"){f=a(this)}else{f=a(this).closest("form")}if(f==null){alert("未找到对应的form对象")}if(c=="FORM"){var d=a.webValidator.getFormElements(f);a.each(d,function(){a.webValidator.setOption(a(this),b)})}else{a.webValidator.setOption(a(this),b)}})};a.fn.formIsValid=function(){var c=a(this);var d=true;var b=a.webValidator.getFormElements(c);a.each(b,function(){var e=a(this);var f=a.webValidator.getOption(e);d=a.webValidator.checkValidBy(e,f);return d});return d};a.fn.checkDataValid=function(){var c=a(this);var d=true;var b=a.webValidator.getFormElements(c);a.each(b,function(){var e=a(this);var f=a.webValidator.getOption(e);d=a.webValidator.checkValidBy(e,f);return d});return d};a.webValidator.getMousePosition=function(c){c=c||window.event;var b=c.pageX||(c.clientX?c.clientX+document.body.scrollLeft:0);var d=c.pageY||(c.clientY?c.clientY+document.body.scrollTop:0);return{x:b,y:d}}})(jQuery);$.webValidator.tipTool=$.webTipTool;$.webValidator.dataType={text:{regex:"([\\s\\S]*)",title:"文本"},number:{regex:"^([+-]?)\\d*\\.?\\d+$",title:"数值"},integer0:{regex:"^-?[1-9]\\d*$",title:"整数"},integer1:{regex:"^[1-9]\\d*$",title:"正整数"},integer2:{regex:"^-[1-9]\\d*$",title:"负整数"},num:{regex:"^([+-]?)\\d*\\.?\\d+$",title:"数字"},num1:{regex:"^[1-9]\\d*$|0",title:"正数（正整数 + 0）"},num2:{regex:"^-[1-9]\\d*$|0",title:"负数（负整数 + 0）"},decimal1:{regex:"^([+-]?)\\d*\\.\\d+$",title:"浮点数"},decimal2:{regex:"^[0-9]\\d*\\.\\d{0,2}$",title:"两位小数的浮点数"},decimal3:{regex:"^(([0-9]+[.]?[0-9]+)|[0-9])$",title:"非负浮点数或整数（正浮点数或整数 + 0）"},decimal4:{regex:"^-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*)$",title:"负浮点数"},decimal5:{regex:"^-?([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0)$",title:"浮点数"},decimal6:{regex:"^(([0-9]+.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*.[0-9]+)|([0-9]*[1-9][0-9]*))$",title:"正浮点数"},decimal7:{regex:"^(-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*))|0?.0+|0$",title:"非正浮点数（负浮点数 + 0）"},email:{regex:"^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$",title:"邮件"},color:{regex:"^[a-fA-F0-9]{6}$",title:"颜色"},url:{regex:"^http[s]?:\\/\\/([\\w-]+\\.)+[\\w-]+([\\w-./?%&=]*)?$",title:"url"},chinese:{regex:"^[\\u4E00-\\u9FA5\\uF900-\\uFA2D]+$",title:"仅中文"},ascii:{regex:"^[\\x00-\\xFF]+$",title:"仅ACSII字符"},zipcode:{regex:"^\\d{6}$",title:"邮编"},mobile:{regex:"^13[0-9]{9}|15[012356789][0-9]{8}|18[0256789][0-9]{8}|147[0-9]{8}$",title:"手机"},ip4:{regex:"^(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)$",title:"ip地址"},notempty:{regex:"^\\S+$",title:"非空"},picture:{regex:"(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$",title:"图片"},rar:{regex:"(.*)\\.(rar|zip|7zip|tgz)$",title:"压缩文件"},date:{regex:"^\\d{4}(\\-|\\/|.)\\d{1,2}\\1\\d{1,2}$",title:"日期"},qq:{regex:"^[1-9]*[1-9][0-9]*$",title:"QQ号码"},tel:{regex:"^(([0\\+]\\d{2,3}-)?(0\\d{2,3})-)?(\\d{7,8})(-(\\d{3,}))?$",title:"电话号码"},username:{regex:"^\\w+$",title:"用户由数字、26个英文字母或者下划线组成的字符串"},letter:{regex:"^[A-Za-z]+$",title:"字母"},letter_u:{regex:"^[A-Z]+$",title:"大写字母"},letter_l:{regex:"^[a-z]+$",title:"小写字母"},idcard:{regex:"^[1-9]([0-9]{14}|[0-9]{17})$",title:"身份证"},custom:{regex:"",title:"自定义类型"}};(function(e){var c=new Date();var b="1,2,3,4,5,6,7,8,9,10,11,12".split(",");var f="31,28,31,30,31,30,31,31,30,31,30,31".split(",");var d=/^\d{2}|\d{4}-\d{1,2}-\d{1,2}$/;var a=/^\d{4,4}$/;e.fn.webDatepicker=function(q){var g=e.extend({},e.fn.webDatepicker.defaults,q);g.hasday=(g.fmt.indexOf("dd")>=0)?true:false;i();function i(){var s,r;if(g.startdate.constructor==Date){s=g.startdate.getFullYear()}else{if(!g.startdate){s=c.getFullYear()}else{if(a.test(g.startdate)){s=g.startdate}else{var t=d.test(g.startdate);if(t){g.startdate=new Date(g.startdate)}s=(t)?g.startdate.getFullYear():c.getFullYear()}}}s-=g.downYears;g.startyear=s;if(g.enddate.constructor==Date){r=g.enddate.getFullYear()}else{if(!g.enddate){r=c.getFullYear()}else{if(a.test(g.enddate)){r=g.enddate}else{var t=d.test(g.enddate);if(t){g.enddate=new Date(g.enddate)}r=(t)?g.enddate.getFullYear():c.getFullYear()}}}r+=g.upYears;g.endyear=r}if(q!=null&&q.startyear!=null){g.startyear=q.startyear}if(q!=null&&q.endyear!=null){g.endyear=q.endyear}var o={clName:"webdatepickercss",fName:"webDatepicker",focName:"webDatepicker_isfc"};function h(){var v=[];for(var u=0;u<=g.endyear-g.startyear;u++){v[u]=g.startyear+u}var s=e('<table class="'+o.clName+'" style="display:none" tabIndex="0" cellpadding="0" cellspacing="0"><thead></thead><tbody></tbody><tfoot></tfoot></table>');var r='<select name="month" class="month">';for(var u in b){r+='<option value="'+u+'">'+b[u]+"</option>"}r+="</select>";var w='<select name="year">';for(var u in v){w+='<option  value="'+v[u]+'">'+v[u]+"</option>"}w+="</select>";e("thead",s).append('<tr class="controls"><th colspan="7" ><span class="prevYear" >&laquo;</span>&nbsp;<span class="prevMonth" >&lsaquo;&nbsp;</span>&nbsp;'+w+r+'&nbsp;<span class="nextMonth" >&nbsp;&rsaquo;</span>&nbsp;<span class="nextYear" >&raquo;</span></th></tr>');if(g.hasday){e("thead",s).append('<tr class="days"><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>')}e("tfoot",s).append('<tr><td ><span class="prevMonth" >&nbsp;&lsaquo;&nbsp;&nbsp;</span></td><td  class="td_today" ><span class="today">选今天</span>&nbsp;<span class="clear" >清空</span>&nbsp;<span class="close" >关闭</span></td><td ><span class="nextMonth" >&nbsp;&nbsp;&rsaquo;&nbsp;</span></td></tr>');if(!g.hasday){e("span.today",s).after('&nbsp;<span class="ok" >确定</span>')}for(var u=0;g.hasday&&u<6;u++){e("tbody",s).append("<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>")}return s}function m(r){var s=curtop=0;if(!r.offsetParent){return false}do{s+=r.offsetLeft;curtop+=r.offsetTop}while(r=r.offsetParent);return[s,curtop]}function p(v,y,C){var G=m(v);var x=G[0],H=G[1];var w=(parseInt(C.x)?parseInt(C.x):0),F=(parseInt(C.y)?parseInt(C.y):0);var z=v.clientHeight;var B,u,s=y[0].clientWidth,E=y[0].clientHeight;var r=document.documentElement.scrollWidth,D=document.documentElement.clientHeight;var A=document.body.scrollLeft,t=document.body.scrollTop||document.documentElement.scrollTop;if(D+t-H-z>=E){u=H+F}else{u=(H-t<E)?(H+F):(H-E+55)}if(r+A-x>=s){B=x+w}else{B=(r>=s)?r-s+A:A}return[B,u]}function l(N,s,E,D){var B=e("select[name=month]",E);var z=e("select[name=year]",E);var A=e("span.prevMonth",E);var C=e("span.nextMonth",E);var H=B.get(0).selectedIndex;var J=z.get(0).selectedIndex;var v=e("select[name=year] option",E).get().length;if(N&&e(N.target).hasClass("prevMonth")){if(0==H&&J){J-=1;H=11;B.get(0).selectedIndex=11;z.get(0).selectedIndex=J}else{H-=1;B.get(0).selectedIndex=H}}else{if(N&&e(N.target).hasClass("nextMonth")){if(11==H&&J+1<v){J+=1;H=0;B.get(0).selectedIndex=0;z.get(0).selectedIndex=J}else{H+=1;B.get(0).selectedIndex=H}}else{if(N&&e(N.target).hasClass("prevYear")){if(J){J-=1;z.get(0).selectedIndex=J}}else{if(N&&e(N.target).hasClass("nextYear")){if(J+1<v){J+=1;z.get(0).selectedIndex=J}}}}}if(0==H&&!J){A.hide()}else{A.show()}if(J+1==v&&11==H){C.hide()}else{C.show()}if(!g.hasday){A.hide();C.hide();e("select.month",E).change(function(){n(s,E,new Date(z.val(),B.val(),1))});return}e(".td_today",E).attr("colspan",5);var u=e("tbody td",E).unbind().empty().removeClass("date");var F=B.val();var x=z.val();var O=new Date(x,F,1);var Q=O.getDay();var L=f[F];if(1==F){L=((x%4==0&&x%100!=0)||x%400==0)?29:28;f[F]=L}if(g.startdate.constructor==Date){var M=g.startdate.getMonth();var t=g.startdate.getDate()}if(g.enddate.constructor==Date){var G=g.enddate.getMonth();var K=g.enddate.getDate()}for(var P=0;P<Q;P++){e(u.get(P)).text((f[F-1<=0?11:F-1]-Q+1)+P).addClass("othermonth")}for(var I=0;I<L;I++){var r=e(u.get(I+Q)).removeClass("chosen").removeClass("othermonth").removeClass("today");if((J||((!t&&!M)||((I+1>=t&&H==M)||H>M)))&&(J+1<v||((!K&&!G)||((I+1<=K&&H==G)||H<G)))){r.text(I+1).addClass("date").hover(function(){e(this).addClass("over")},function(){e(this).removeClass("over")}).click(function(){var y=new Date(z.val(),B.val(),e(this).text());n(s,E,y)});if(I+1==D.getDate()&&F==D.getMonth()&&x==D.getFullYear()){r.addClass("chosen")}if(I+1==c.getDate()&&F==c.getMonth()&&x==c.getFullYear()){r.addClass("today")}}}for(var w=0;w<(6*7-(P+I));w++){e(u.get(w+P+I)).text(w+1).addClass("othermonth")}}function n(s,u,r){if(r&&r.constructor==Date){s.val(e.fn.webDatepicker.formatOutput(r,g.fmt))}u.remove();u=null;var t=s.data(o.fName);t.hasDatepicker=false;s.focus()}var j=null;function k(t){var v={hasDatepicker:false};var s=e(t.target);s.data(o.fName,v);e("span.close",e(document)).trigger("click");if(v.hasDatepicker==false){v.hasDatepicker=true;var u=s.val();if(u.length==4){u=u+"-01-01"}if(u.length==7){u=u+"-01"}if(u&&d.test(u)){var x=e.fn.webDatepicker.parseDate(u,g.fmt)}else{var x=(g.chosendate.constructor==Date)?g.chosendate:(g.chosendate)?new Date(g.chosendate):c}j=h();v.dp=j;e("body").prepend(j);e(j).show();var w=p(s.get(0),j,g);j.css({position:"absolute",left:w[0],top:w[1]});e("span",j).css("cursor","pointer");e("select",j).bind("change",function(){l(null,s,j,x)});e("span.prevMonth",j).attr("title","前翻1月\n快捷键：←").click(function(y){l(y,s,j,x);return false});e("span.nextMonth",j).attr("title","向后翻 1 月\n快捷键：→").click(function(y){l(y,s,j,x);return false});e("span.prevYear",j).attr("title","向前翻 1 年\n快捷键：↑").click(function(y){l(y,s,j,x);return false});e("span.nextYear",j).attr("title","向后翻 1 年\n快捷键：↓").click(function(y){l(y,s,j,x);return false});e("span.today",j).attr("title","选择今天\n快捷键：T").click(function(){n(s,j,new Date());return false});e("span.close",j).attr("title","关闭的快捷键：[Esc]").click(function(){n(s,j)});e("span.clear",j).attr("title","清空的快捷键：[C]").click(function(){n(s,j);s.val("")});e("span.ok",j).click(function(){n(s,j,new Date(e('[name="year"]',j).val(),e('[name="month"]',j).val(),1));return false});var r=(s.attr("is_readonly")==null||s.attr("is_readonly")=="1");if(r){j.focus()}j.keydown(function(z){var y=z.which?z.which:z.keyCode;switch(y){case 27:e("span.close",j).trigger("click");break;case 37:e(e("span.prevMonth",j).get(0)).trigger("click");break;case 38:e("span.prevYear",j).trigger("click");break;case 39:e(e("span.nextMonth",j).get(0)).trigger("click");break;case 40:e("span.nextYear",j).trigger("click");break;case 84:e("span.today",j).trigger("click");break;case 67:e("span.clear",j).trigger("click");break}return false});e("select[name=month]",j).get(0).selectedIndex=x.getMonth();e("select[name=year]",j).get(0).selectedIndex=Math.max(0,x.getFullYear()-g.startyear);l(null,s,j,x);e(j).css("z-index",parseInt(new Date().getTime()/1000)+1)}return e(j)}e(document).click(function(r){$this=e(r.target);var s=$this.data(o.fName);if($this.closest("."+o.clName).length>0){return}if(s&&s.hasDatepicker==true){return}e("span.close",j).trigger("click");return});return this.each(function(){var s=e(this);if(s.is("input")&&"text"==s.attr("type")){var r=(s.attr("is_readonly")==null||s.attr("is_readonly")=="1");if(r){s.click(function(t){k(t);return false})}if(!r){s.dblclick(k);s.keyup(function(u){var t=u.which?u.which:u.keyCode;if((t>=47&&t<=57)&&e(u.target).val().length>=4){k(u)}})}s.focus(function(u){var t=e(u.target);if(r){e(u.target).attr("readonly","readonly")}})}})};e.fn.webDatepicker.formatOutput=function(h,g){var m=h.getMonth()+1;var o=h.getDate();var l="",n="";if(g==undefined){g="yyyy-mm-dd"}for(var j=0;j<g.length;j++){var k=g.charAt(j);l+=k;switch(l){case"dd":n+=(String(o).length===1)?("0"+o):o;l="";break;case"mm":n+=(String(m).length===1)?(m="0"+m):m;l="";break;case"yyyy":n+=h.getFullYear();l="";break;default:if(l.length===2&&l.indexOf("y")!==0){n+=l.substring(0,1);l=l.substring(1,2)}else{if((l.length===3&&l.indexOf("yyy")===-1)){l=""}}}}return n};e.fn.webDatepicker.parseDate=function(h,g){var l=1,m=1,n=0,k="";if(g==undefined){g="yyyy-mm-dd"}for(var j=0;j<g.length;j++){k+=g.charAt(j);switch(k){case"dd":m=h.substring(j-1,j+1);k="";break;case"mm":l=h.substring(j-1,j+1);k="";break;case"yyyy":n=h.substring(j-4,j+1);k="";break;default:if(k.indexOf("y")===-1&&k.indexOf("m")===-1&&k.indexOf("d")===-1){k=""}}}return new Date(parseInt(n,10),parseInt(l-1,10),parseInt(m,10))};e.fn.webDatepicker.defaults={chosendate:c,fmt:"yyyy-mm-dd",startdate:c.getFullYear(),enddate:c.getFullYear()+1,downYears:20,upYears:20,x:18,y:18}})(jQuery);(function(a){a.webDropdragUtil={startMove:false,updatePosition:function(f){var b=f.data;var d=a(b.target);var h=a.webValidator.getMousePosition(f);var g=b.oldLeft+(h.x-b.oldMouseX);var c=b.oldTop+(h.y-b.oldMouseY);if((g<0)||(c<0)){return}d.css("top",c);d.css("left",g);if(b.ops.onMove!=null){b.ops.onMove(d)}},mouseDown:function(b){return false},mouseMove:function(b){if(b.data.target!=null){if(a.webDropdragUtil.startMove){a.webDropdragUtil.updatePosition(b)}}return false},mouseUp:function(b){a.webDropdragUtil.startMove=false;a(b.data.target).fadeTo(0,1);a(document).unbind(".webdropdrag");b.data.handler.css("cursor","");return false},mouseLeave:function(b){a.webDropdragUtil.startMove=false;a(b.data.target).fadeTo(0,1);a(document).unbind(".webdropdrag");b.data.handler.css("cursor","");return false}};a.fn.webDropdrag=function(b){var c={handler:null,onMove:null,opacity:0.5};return this.each(function(){var g=a.extend(c,b);var e=a(this);var f=e.find("iframe").length>0;if(e.hasClass("webDropdrag")){return}else{e.addClass("webDropdrag")}var d=a(g.handler,e);if(d.length<1){d=e}d.bind("mousedown.webdropdrag",{target:this},function(i){a(this).css("cursor","move");e.css("position","absolute").css("z-index",parseInt(new Date().getTime()/1000));var j=a.webValidator.getMousePosition(i);var h={target:i.data.target,handler:d,ops:g,oldMouseX:j.x,oldMouseY:j.y,oldTop:i.data.target.offsetTop,oldLeft:i.data.target.offsetLeft};a.webDropdragUtil.startMove=true;a(i.data.target).fadeTo(0,g.opacity);if(h.handler!=null){h.handler.css("cursor","move")}a(document).bind("mousedown.webdropdrag",h,a.webDropdragUtil.mouseDown);a(document).bind("mousemove.webdropdrag",h,a.webDropdragUtil.mouseMove);a(document).bind("mouseup.webdropdrag",h,a.webDropdragUtil.mouseUp);a(document).bind("mouseleave.webdropdrag",h,a.webDropdragUtil.mouseUp)}).bind("mousemove.webdropdrag",{target:this},function(h){if(!a.webDropdragUtil.startMove){return}}).bind("mouseup.webdropdrag",{target:this},function(h){a.webDropdragUtil.startMove=false;a(h.data.target).fadeTo(0,1);a(document).unbind(".webdropdrag");a(this).css("cursor","")});if(f){d.bind("mouseleave.webdropdrag",{target:this},a.webDropdragUtil.mouseUp)}})};a.webResizableUtil={modifySize:function(r){var s=r.data;var j=s.ops.minWidth;var p=s.ops.maxWidth;var c=s.ops.minHeight;var l=s.ops.maxHeight;var o,t,b,q;var k,d,f,m;o=s.startLeft;t=s.startTop;b=s.startWidth;q=s.startHeight;var i=s.startX;var h=s.startY;var g=a(s.target);var n=s.moveMode;if(n.indexOf("e")!=-1){f=Math.min(Math.max((b+r.pageX-i),j),p)}if(n.indexOf("s")!=-1){m=Math.min(Math.max((q+r.pageY-h),c),l)}if(n.indexOf("w")!=-1){f=b-r.pageX+i;if(f<=p&&f>=j){k=o+r.pageX-i}}if(n.indexOf("n")!=-1){m=q-r.pageY+h;if(m<=l&&m>=c){d=t+r.pageY-h}}if(f<=p&&f>=j){g.css({left:k});g.width(f)}if(m<=l&&m>=c){g.css({top:d});g.height(m)}if(s.ops.onResize!=null){s.ops.onResize(g)}},mouseDown:function(b){return false},mouseMove:function(b){if(a.webResizableUtil.startResize){a.webResizableUtil.modifySize(b)}return false},mouseUp:function(b){a(document).unbind(".webresizable");a.webResizableUtil.startResize=false;a(b.data.target).fadeTo(0,1);a("body").css("cursor","");return false},mModes:"n, e, s, w, ne, se, sw, nw, all".split(","),startResize:false,getMoveMode:function(h){var j=a(h.data.target);var f=j.offset();var b=j.outerWidth();var l=j.outerHeight();var c=7;var d="";if(h.pageY>f.top&&h.pageY<f.top+c){d+="n"}else{if(h.pageY<f.top+l&&h.pageY>f.top+l-c){d+="s"}}if(h.pageX>f.left&&h.pageX<f.left+c){d+="w"}else{if(h.pageX<f.left+b&&h.pageX>f.left+b-c){d+="e"}}for(var g=0;g<this.mModes.length;g++){var k=this.mModes[g].replace(/(^\s*)|(\s*$)/g,"");if(k=="all"||k==d){return d}}return""},getElCss:function(c,b){var d=parseInt(c.css(b));return isNaN(d)?0:d}};a.fn.webResizable=function(b){var c={onResize:null,opacity:0.5,minWidth:50,maxWidth:800,minHeight:50,maxHeight:600};return this.each(function(){var f=a.extend(c,b);var d=a(this);var e=d.find("iframe").length>0;if(d.hasClass("webResizable")){return}else{d.addClass("webResizable")}d.bind("mousedown.webResizable",{target:this},function(i){var j=a.webResizableUtil.getMoveMode(i);if(j==""){return}var h=a(i.data.target);var g={target:i.data.target,ops:f,moveMode:a.webResizableUtil.getMoveMode(i),startLeft:a.webResizableUtil.getElCss(h,"left"),startTop:a.webResizableUtil.getElCss(h,"top"),startX:i.pageX,startY:i.pageY,startWidth:h.outerWidth(),startHeight:h.outerHeight()};a.webResizableUtil.startResize=true;h.fadeTo(0,f.opacity);a(document).bind("mousedown.webresizable",g,a.webResizableUtil.mouseDown);a(document).bind("mousemove.webresizable",g,a.webResizableUtil.mouseMove);a(document).bind("mouseup.webresizable",g,a.webResizableUtil.mouseUp);a(document).bind("mouseleave.webresizable",g,a.webResizableUtil.mouseUp);a("body").css("cursor",g.moveMode+"-resize")}).bind("mousemove.webresizable",{target:this},function(g){if(a.webResizableUtil.startResize){return}var h=a.webResizableUtil.getMoveMode(g);if(h==""){a(g.data.target).css("cursor","")}else{a(g.data.target).css("cursor",h+"-resize")}}).bind("mouseleave.webresizable",{target:this},function(g){a(g.data.target).fadeTo(0,1);a(g.data.target).css("cursor","")})})}})(jQuery);(function(a){a.webDialogUtil={defaults:{onResize:null,onClose:null,name:null,width:400,height:170,top:0,left:0,title:"&nbsp;",ismodel:false,url:null,handle:null,applyTo:null,checkOnClose:false,content:null,opacity:0.5,minWidth:50,maxWidth:1024,minHeight:50,maxHeight:768,animate:300,event:null,startPos:{x:0,y:0}},openedCount:0,createDlg:function(h){var l=a("<div class='webdialog' style:'display:none'></div>");if(h.name!=null){l.attr("name",h.name)}var f=a("<div class='header'></div>");var g=a("<div class='title'></div");var j=a("<div class='webdialog_tools'><a class='closer' href='javascript:void(0)' ></a></div");var m=a("<div class='webdialog_body'></div>");g.append(h.title);f.append(g).append(j);l.append(f).append(m);m.append(h.content);if(h.url!=null){var d=a('<iframe src="'+h.url+'" width="100%" height="100%" scrolling="auto" frameborder="2" marginheight="10" marginwidth="10" ></iframe>');m.append(d)}if(h.buttons!=null&&h.buttons.length>0){var o=a('<div class="webdialog_buttons"></div>');for(var e=0;e<h.buttons.length;e++){if(h.buttons[e].btn!=null){var b=a(h.buttons[e].btn);var k=b.webButton();if(h.buttons[e].onclick!=null){k.bind("click",{target:l},h.buttons[e].onclick)}o.append(k)}else{o.append(h.buttons[e])}}m.append(o)}var n=(a(window).height()-parseInt(h.top))/2+a(document).scrollTop();var c=(a(window).width()-parseInt(h.left))/2+a(document).scrollLeft();l.css({top:n,left:c,width:Math.min(Math.max(h.width,h.minWidth),h.maxWidth),height:Math.min(Math.max(h.height,h.minHeight),h.maxHeight)});return l}};a.fn.webDialog=function(b){var c=a.webDialogUtil.defaults;return this.each(function(){var e=a.extend({},c,b);e.handle=a(this);var d={dlg:null,applyVisible:true,open:function(k){this.dlg=a.webDialogUtil.createDlg(k);if(k.applyTo!=null){if(k.applyTo.hasClass("webDialog_apply")){this.dlg.empty();return}else{k.applyTo.addClass("webDialog_apply")}k.applyTo.after(this.dlg);a(".webdialog_body",this.dlg).append(k.applyTo);this.applyVisible=k.applyTo.is(":visible");if(!this.applyVisible){k.applyTo.show()}}else{k.handle.append(this.dlg)}var j=a(".header",this.dlg);var f=j.outerHeight();var g=a(".webdialog_body",this.dlg);var h=parseInt(g.css("padding-top"))+parseInt(g.css("padding-bottom"))+11;g.css("height",this.dlg.innerHeight()-f-h);this.dlg.webDropdrag({handler:".header",opacity:k.opacity});var i={onResize:function(l){a(".webdialog_body",l).css("height",l.innerHeight()-f-h)}};k=a.extend(k,i);this.dlg.webResizable(k);a(".closer",j).bind("click",{target:this.dlg},function(l){d.closeDlg(l)})},show:function(h){var n=parseInt(new Date().getTime()/1000);if(h.ismodel){a("body").setmask({zindex:n})}var m=parseInt(this.dlg.width());var j=parseInt(this.dlg.height());var i=(a(window).width()-m)/2+a(document).scrollLeft();var l=(a(window).height()-j)/3+a.webDialogUtil.openedCount*30+a(document).scrollTop();if(l<5){l=5}var k=0;var f=0;if(h.animate>=1){if(h.event!=null){var g=a.webValidator.getMousePosition(h.event);h.startPos=g;k=g.y;f=g.x}this.dlg.css({left:f,top:k,width:0,height:0,opacity:0.5});this.dlg.animate({left:i,top:l,width:m,height:j,opacity:1},{duration:300})}this.dlg.css({left:i,top:l,opacity:1,"z-index":n+1})},hide:function(){this.dlg.hide()},close:function(){a(".header .closer",this.dlg).trigger("click")},closeDlg:function(h){var g=true;var f=h.data.target;if(e.checkOnClose){g=f.checkDataValid()}if(e.onClose!=null){g=e.onClose(h,e)}if(g==false){return}if(e.applyTo!=null){f.before(e.applyTo);if(!d.applyVisible){e.applyTo.hide()}e.applyTo.removeClass("webDialog_apply")}if(e.animate>=1){f.animate({left:e.startPos.x,top:e.startPos.y,width:0,height:0},{duration:e.animate,complete:function(){a(this).remove()}})}else{f.remove()}a.webDialogUtil.openedCount--;if(e.ismodel){a("body").unmask()}}};d.open(e);d.show(e);a.webDialogUtil.openedCount++;this.dialog=d})};a.fn.closeWebDialog=function(b){if(b!=null){var c=a(document).find("div.webdialog[name='"+b+"']");c.find(".header .closer").trigger("click");return}return this.each(function(){if(this.dlg!=null){a(".header .closer",this.dlg).trigger("click")}else{a(this).closest("div.webdialog").find(".header .closer").trigger("click")}})}})(jQuery);(function($){var tcl={open:"open",closed:"closed",plus_m:"plusm",plus_l:"plusl",minus_m:"minusm",minus_l:"minusl",line_m:"linem",line_l:"linel",last:"last",nolast:"nolast",hitbtn:"hitbtn",icondiv:"icondiv",selected:"selected"};$.webTreeUtil={defaults:{target:"_blank",enableIcon:false,collapsed:true,expandOne:false,enable_hitbtn:true,enable_selbtn:false,enable_href:false,selbtn:{type:"checkbox",name:null,link:null,iscascade:true,isthree:true},icons:{type:0,leaf:"leaficon2",open:"branch-o",closed:"branch-c",level:["icon_def","icon_1","icon_2","icon_3","icon_4"]},itemClass:["item_def","item_1","item_2","item_3","item_4"],loadOnExpand:false,loadUrl:null,name_map:{id:"id",name:"name",isleaf:"isleaf",url:"url",parent_id:"parent_id",param:"param",check_status:"check_status"},resultName:null,form_used:false,lockedOnLoad:false,onPreLoad:null,onLoadFinished:false,onCollapse:false,onExpand:false,onSelect:false,onCheckClick:false,check_status:{CHECK:"1",NOCHECK:"0",HALFCHECK:"2"}},getNodeLevel:function(node,t_id){var p=node;var l=0;while(p.attr("id")!=t_id){p=p.parent();var n=p.prop("tagName");if(n=="UL"){l++}}return l},initNode:function(node,root){var op=root.options;var tree_id=root.rootNode.attr("id");var br1=node.find("li");var pnid=node.attr("id");br1.each(function(i){var $self=$(this);if($self.attr("id")==null){$self.attr("id",tree_id+"_"+pnid+"_"+i)}if($self.filter(":has(div.nodeitem)").length>0){return}var nitem=$self.find(">div:first").addClass("nodeitem");var elA=nitem.find(">a");if($("#form1").length>0){elA.bind("click",function(event){event.preventDefault()})}nitem.click(function(e){if(root.currSelected){root.currSelected.find(".nodeitem").removeClass(tcl.selected)}var nd=$(this);nd.toggleClass(tcl.selected);root.currSelected=nd.parent();var hrf=nd.find(">a").attr("href");if(hrf!=null){$("#form1").attr("target",op.target);$("#form1").attr("action",hrf);$("#form1").submit()}if(op.onSelect){op.onSelect(root.currSelected)}}).find(">a:not([target])").attr("target",op.target);if(op.enableIcon){nitem.prepend('<span class="icondiv"></span>')}if(op.itemClass!=null){var iCl=$.webTreeUtil.getNodeLevel(nitem,tree_id);nitem.addClass(op.itemClass[iCl]||op.itemClass[0])}var btn=$('<div class="'+tcl.hitbtn+'"></div>');$self.prepend(btn);if(!op.enable_hitbtn){btn.hide()}var child=$self.find(">ul");var enC=!$self.hasClass("open")&&!$self.is(":has(li.open)");if(op.collapsed&&enC){child.hide()}$.webTreeUtil.formatNode($self,root);if(op.enable_selbtn){var icheck=$self.attr("check_status");icheck=((icheck==undefined)?op.check_status.NOCHECK:icheck);var selbtn=$('<span class="selbtn '+op.selbtn.type+icheck+'" check_status="'+icheck+'"></span>');var def_val=$self.attr("check_value");def_val=(def_val!==undefined?def_val:$self.attr("id"));if(op.selbtn.name!=null&&op.selbtn.name!=""){selbtn.append('<input type="hidden" class="selbtn_inputhidden" name="'+op.selbtn.name+'" value="'+def_val+'" />')}nitem.prepend(selbtn);$.webTreeUtil.updateCheckBtnStatus(selbtn,root,false);selbtn.click(function(){sbt=$(this);$.webTreeUtil.updateCheckBtnStatus(sbt,root);if(root.options.onCheckClick){root.options.onCheckClick(sbt.parent().parent(),sbt.attr("check_status"))}return false})}})},formatNode:function(node_li,root){var islast=node_li.is(":last-child");if(islast){node_li.addClass(tcl.last)}else{node_li.removeClass(tcl.last)}var op=root.options;var child=node_li.find(">ul");var isleaf=child.length>0?false:true;if(!islast&&op.enable_hitbtn){child.addClass(tcl.nolast)}var nodeicon="leaf";var btn=node_li.find(">div."+tcl.hitbtn);btn.removeClass().addClass(tcl.hitbtn);var icon=node_li.find(">div.nodeitem>span.icondiv");icon.removeClass().addClass("icondiv");if(isleaf){if(islast){btn.addClass(tcl.last)}btn.addClass(islast?tcl.line_l:tcl.line_m);icon.addClass(this.getIcons(node_li,op));node_li.find(">div.nodeitem").addClass("leafitem")}else{var isC=child.css("display")=="none";if(islast){btn.addClass(tcl.last)}btn.addClass(isC?tcl.closed:tcl.open);btn.addClass(isC?islast?tcl.plus_l:tcl.plus_m:islast?tcl.minus_l:tcl.minus_m);icon.addClass(this.getIcons(node_li,op,!isC))}},getIcons:function(node_li,op,isopen){var ic="";if(op.icons.type==0){ic=op.icons[(isopen==null)?"leaf":(isopen?"open":"closed")]}else{if(op.icons.type==1||op.icons.type==4){var iCl=$.webTreeUtil.getNodeLevel(node_li,op.root.attr("id"));ic="icondiv1 "+op.icons.level[iCl]||op.icons.level[0];if(isopen==null&&op.icons.type==4){ic=op.icons.leaf}}else{if(op.icons.type==2){var iType=node_li.attr("icon_type");ic=(iType!==undefined)?iType:""}}}return ic},expandNodes:function(node_li,op,isexp){var child=node_li.find("li:has(ul)");child.each(function(){$.webTreeUtil.expandNode($(this),op,isexp)})},createNode:function(jsdata,mpName,op){if(mpName==null){mpName=$.webTreeUtil.defaults.name_map}var newN=$("<li/>",{id:jsdata[mpName.id]});if(jsdata[mpName.check_status]=="1"){newN.attr("check_status","1")}var ht=jsdata[mpName.name];var url=jsdata[mpName.url];if(op.enable_href&&url!=null&&url.length>1){ht=$("<a/>",{href:url}).append(ht)}newN.append($("<div/>").append(ht));if((!jsdata[mpName.isleaf])||(jsdata[mpName.isleaf]=="0")){newN.append("<ul/>")}newN.data("node_data",jsdata);if(jsdata[mpName.param]!=null){newN.data("node_param",jsdata[mpName.param])}return newN},createNodeHtml:function(jsdata,mpName){if(mpName==null){mpName=$.webTreeUtil.defaults.name_map}var html=[];html.push('<li id="');html.push(jsdata[mpName.id]);html.push('" ><div>');var ht=jsdata[mpName.name];var url=jsdata[mpName.url];if(url!=null&&url.length>1){html.push('<a href="');html.push(url);html.push('">');html.push(ht);html.push("</a>")}else{html.push(ht)}html.push("</div>");if((!jsdata[mpName.isleaf])||(jsdata[mpName.isleaf]=="0")){html.push("<ul></ul>")}html.push("</li>");return html.join("").toString()},addNode:function(tree,newNode,posNode,ischild){if(ischild==null){ischild=true}if(posNode==null){posNode=tree}var isroot=posNode.data("root")==null?false:true;var parentNode=ischild?posNode:isroot?posNode:posNode.parent().parent();var root=tree.data("root");if(root==null){return}if(isroot){parentNode.append(newNode)}else{if(ischild==false){posNode.after(newNode)}else{var ul=posNode.find(">ul");if(ul.length==0){var child=$("<ul></ul>");if(root.options.collapsed){child.hide()}posNode.append(child)}posNode.find(">ul").append(newNode)}}$.webTreeUtil.formatNode(newNode.prev("li"),root);tree.trigger("onAddNode",{node:newNode,parent:parentNode})},loadNode:function(tree,node,ops){var root=tree.data("root");var exe=function(op){try{var ss=op.success;var getfun=function(jsdata){if(jQuery.isFunction(ss)){ss.call($,jsdata)}if(root.options.onPreLoad!=null){root.options.onPreLoad(jsdata,ops)}var dNode=jsdata.result;if(op.resultName!=undefined){try{dNode=eval("jsdata."+op.resultName)}catch(e){dNode=null}}var mpName=$.extend(root.options.name_map,op.name_map||{});var node_id=node.attr("id");var isLoadRoot=(tree.attr("id")==node_id);var pgp={};var gp_s=[];var l_pnode=null;var lpnode;$.each(dNode,function(key,val){if($("#"+val[mpName.id],tree).length>0){return}var $pid=val[mpName.parent_id];if($pid==0||$pid==""||($pid==null)){$pid=tree.attr("id")}if(!op.isfull&&(!isLoadRoot&&$pid!=node_id)){return}var newN=$.webTreeUtil.createNode(val,mpName,op);if(pgp[$pid]==null){pgp[$pid]=[];gp_s.push($pid)}pgp[$pid].push(newN[0])});var pnode=null;$.each(gp_s,function(n,ap){pnode=node;if(op.isfull||isLoadRoot){pnode=(ap!=node_id)?$("#"+ap,tree):tree;if(pnode.length<1){pnode=tree}}$.webTreeUtil.addNode(tree,$(pgp[ap]),pnode,true)});if(root.options.onLoadFinished){root.options.onLoadFinished(pnode||tree,jsdata)}};op=$.extend({type:"POST",url:op.url||root.options.loadUrl,dataType:"json",cache:false,success:getfun},op);op.success=getfun;op.isformdata=root.options.form_used;$.webUtil.submitByAjax(op)}catch(e){alert("节点加载异常！"+e)}finally{}};var tl=root.options.lockedOnLoad?tree:node;var tm=setTimeout(function(){exe(ops||{});tm=null;tl.unmask()},50);tl.setmask({msg:$.webUtil.setting.messageOnLoading})},togglerNode:function(node_li,op){var btn=node_li.find(">div."+tcl.hitbtn);var isExp=(btn.hasClass(tcl.closed)?true:false);var isld=(op.loadOnExpand==true||op.loadOnExpand>0);if(isExp&&op.loadOnExpand==2){var emp=node_li.find(">ul").is(":empty");if(!emp){isld=false}}if(isExp&&isld){var ndata=node_li.data("node_data");var nparam=$.extend(node_li.data("node_param"),ndata||{});this.loadNode(op.root,node_li,{url:ndata.url?ndata.url:op.loadUrl,data:nparam,isfull:false})}this.expandNode(node_li,op,isExp)},expandNode:function(node_li,op,isExp){var child=node_li.find(">ul");if(child.length<1){return}var btn=node_li.find(">div."+tcl.hitbtn);var isO=btn.hasClass(tcl.closed)?false:true;if(isO&&isExp){return}if(isExp!=null){isO=isExp?false:true}if(isO){child.slideUp(300)}else{child.slideDown(300)}btn.removeClass(!isO?tcl.closed:tcl.open).addClass(isO?tcl.closed:tcl.open);var islast=btn.hasClass(tcl.last)?true:false;btn.removeClass(!isO?tcl.plus_m:tcl.minus_m).removeClass(tcl.plus_l).removeClass(tcl.minus_l);btn.addClass(isO?islast?tcl.plus_l:tcl.plus_m:islast?tcl.minus_l:tcl.minus_m);if(op.enableIcon&&op.icons.type==0){var icon=node_li.find(">div.nodeitem>span.icondiv");icon.removeClass(op.icons[!isO?"closed":"open"]);icon.addClass(op.icons[isO?"closed":"open"])}if(op.onExpand&&isExp){op.onExpand(node_li)}else{if(op.onCollapse&&!isExp){op.onCollapse(node_li)}}},updateCheckBtnStatus:function(box,root,isHit,nv){var op=root.options;var s=op.check_status;var node_li=box.parent().parent();if(isHit==null){isHit=true}var curr=box.attr("check_status");var newval=(isHit)?((curr==s.CHECK||curr==null)?s.NOCHECK:s.CHECK):curr;if(op.selbtn.type=="radio"&&curr==s.CHECK){newval=curr}if(nv!=null){newval=nv}box.updateCheckStatus(newval,op);if(op.selbtn.type=="checkbox"){if(op.selbtn.iscascade){if(isHit){node_li.find("ul span.selbtn").updateCheckStatus(newval,op)}var pbox=node_li.parents("li:has(span.selbtn)");if(!isHit){pbox=$.merge(node_li,pbox)}pbox.each(function(){var par=$(this);var p_selbtn=par.find(">div.nodeitem>span.selbtn");var sBox=par.find("ul span.selbtn");var c_all=sBox.length;var c_ok=sBox.filter("."+op.selbtn.type+s.CHECK).length;if(c_all==0){return}var newv=(c_ok==0)?s.NOCHECK:(c_all==c_ok)?s.CHECK:s.HALFCHECK;p_selbtn.updateCheckStatus(newv,op)})}}else{if(op.selbtn.type=="radio"){if(newval==s.CHECK&&root.currChecked!=null&&(node_li.attr("id")!=root.currChecked.attr("id"))){root.currChecked.find(">div.nodeitem>span.selbtn").updateCheckStatus(s.NOCHECK,op)}if(newval==s.CHECK){root.currChecked=node_li}}}}};$.fn.replaceClass=function(c1,c2){var $this=$(this);if($this.hasClass(c1)){$this.removeClass(c1).addClass(c2)}return $this};$.fn.updateCheckStatus=function(newval,op){return this.each(function(){var box=$(this);var old=box.attr("check_status");if(op.selbtn.link!=null){$(">"+op.selbtn.link,box.parent()).val(newval)}if(op.selbtn.name!=null&&op.selbtn.name!=""){box.find("input").attr("disabled",(newval==op.check_status.NOCHECK?true:false))}box.attr("check_status",newval);box.replaceClass(op.selbtn.type+old,op.selbtn.type+newval)})};$.fn.setNodeCheckStatus=function(nodes,newval){var root=this.data("root");if(nodes!=null){nodes.each(function(){var box=$(this).find(">div.nodeitem>span.selbtn");$.webTreeUtil.updateCheckBtnStatus(box,root,false,newval)})}else{var box=$(this).find("div.nodeitem>span.selbtn");$.webTreeUtil.updateCheckBtnStatus(box,root,false,newval)}return this};$.fn.getCheckedNodeData=function(){var checkedNode=$("span.selbtn[check_status='1']",$(this)).parent().parent();var datas=[];checkedNode.each(function(){datas.push($(this).data("node_data"))});return datas};$.fn.getCheckedNode=function(){var checkedNode=$("span.selbtn[check_status='1']",$(this)).parent().parent();return checkedNode};$.fn.getChildNode=function(){return $(this).find(">ul>li")};$.fn.loadNode=function(op,node){if(node==null){node=this}var tm=setTimeout(function(){$.webTreeUtil.loadNode($(node),node,op);tm=null},50)};$.fn.expand=function(node,toExp){if(node==null){node=this}var root=this.data("root");$.webTreeUtil.expandNodes(node,root.options,toExp);return this};$.fn.addNode=function(newNode,posNode,ischild){$.webTreeUtil.addNode($(this),newNode,posNode,ischild);return this};$.fn.removeNode=function(node){if(node==null){return}var parentNode=node.parent().parent();var root=this.data("root");if(node[0]===(root.currSelected||root.rootNode)[0]){root.currSelected=null}var isroot=node.data("root")==null?false:true;if(isroot){node.remove();return}if(parentNode.find(">ul>li").length>1){var prevNode=node.prev("li");node.remove();$.webTreeUtil.formatNode(prevNode,root)}else{node.parent().remove()}$(this).trigger("onRemoveNode",{node:node,parent:parentNode})};$.fn.getSelectedNode=function(){var root=$(this).data("root");return root?(root.currSelected||root.rootNode):null};$.fn.extend({webTree:function(ops){ops=$.extend(true,{},$.webTreeUtil.defaults,ops);var tree=this;if(tree.hasClass("webtree")){return tree}tree.addClass("webtree");ops.root=tree;var root={rootNode:tree,options:ops,currSelected:null,currChecked:null};tree.data("root",root);function toggler(node_li){$.webTreeUtil.togglerNode(node_li,ops);if(ops.expandOne){node_li.siblings(":has(>ul:not(:hidden))").each(function(){$.webTreeUtil.expandNode($(this),ops,false)})}}root.rootNode.bind("click",function(e){var tar=$(e.target);if(tar.is("div.hitbtn")){toggler(tar.parent("li"));return false}else{if(tar.is(".nodeitem")){toggler(tar.parent("li"));return false}else{if(tar.is(".icondiv")&&!ops.enable_hitbtn){toggler(tar.parent().parent());return false}}}});$.webTreeUtil.initNode(tree,root);tree.bind("onAddNode",function(e,data){var root=$(this).data("root");$.webTreeUtil.initNode(data.parent,root);$.webTreeUtil.formatNode(data.parent,root);$.webTreeUtil.updateCheckBtnStatus($(">span.selbtn",data.parent),root,false)}).bind("onRemoveNode",function(e,data){var root=$(this).data("root");$.webTreeUtil.formatNode(data.parent,root);$.webTreeUtil.updateCheckBtnStatus($(">span.selbtn",data.parent),root,false)});return tree}})})(jQuery);